

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.py_utils module &mdash; Lingvo  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.quant_utils module" href="lingvo.core.quant_utils.html" />
    <link rel="prev" title="lingvo.core.program module" href="lingvo.core.program.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.py_utils module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.py_utils.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.py_utils">
<span id="lingvo-core-py-utils-module"></span><h1>lingvo.core.py_utils module<a class="headerlink" href="#module-lingvo.core.py_utils" title="Permalink to this headline">¶</a></h1>
<p>Common utilities.</p>
<dl class="function">
<dt id="lingvo.core.py_utils._FromGlobal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_FromGlobal</code><span class="sig-paren">(</span><em class="sig-param">field_name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_FromGlobal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._FromGlobal" title="Permalink to this definition">¶</a></dt>
<dd><p>Get ‘field_name’ from a global configuration object.</p>
<p>Currently the global configuration object used is FLAGS, but this may
change to Cluster() or an equivalent stack-scoped config object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>field_name</strong> – The string field name to look up.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value associated with the global configuration string ‘field_name’.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Assert">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Assert</code><span class="sig-paren">(</span><em class="sig-param">condition</em>, <em class="sig-param">data</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Assert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Assert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_equal</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_greater_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_greater_equal</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_greater_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_greater_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_greater">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_greater</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_greater"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_greater" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_less_equal">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_less_equal</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_less_equal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_less_equal" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_less">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_less</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_less"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_less" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_between">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_between</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">l</em>, <em class="sig-param">r</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_between"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_between" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_shape_match">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_shape_match</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_shape_match"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_shape_match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_same_dim0">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_same_dim0</code><span class="sig-paren">(</span><em class="sig-param">xs</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_same_dim0"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_same_dim0" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.assert_even_divide">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">assert_even_divide</code><span class="sig-paren">(</span><em class="sig-param">denorm</em>, <em class="sig-param">num</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#assert_even_divide"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.assert_even_divide" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that denorm is evenly divided by num.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._CheckNumerics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CheckNumerics</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">message=None</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CheckNumerics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CheckNumerics" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CheckNumerics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CheckNumerics</code><span class="sig-paren">(</span><em class="sig-param">inp</em>, <em class="sig-param">message=None</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CheckNumerics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CheckNumerics" title="Permalink to this definition">¶</a></dt>
<dd><p>Check numerics for tensors in inp.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.with_dependencies">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">with_dependencies</code><span class="sig-paren">(</span><em class="sig-param">dependencies</em>, <em class="sig-param">output_tensor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#with_dependencies"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.with_dependencies" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._PrintOptions">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_PrintOptions</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_PrintOptions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._PrintOptions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._Print">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Print</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Print"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Print" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Log">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Log</code><span class="sig-paren">(</span><em class="sig-param">value</em>, <em class="sig-param">prefix</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Log"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Log" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints out values of tensors.</p>
<dl class="simple">
<dt>Useful for debugging. E.g.,</dt><dd><p>x = … a tf.Tensor …
y = … a tf.Tensor …
z = compute(x, y)
z = Log(z, ‘debug compute()’, x=x, y=y)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – A Tensor. Log happens after this tensor’s computed.</p></li>
<li><p><strong>prefix</strong> – Every tensor is logged with this prefix.</p></li>
<li><p><strong>**kwargs</strong> – keywords and tensors. Tensors are logged in the sort order of
these keywards.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value is returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._Save">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Save</code><span class="sig-paren">(</span><em class="sig-param">steps</em>, <em class="sig-param">prefix</em>, <em class="sig-param">key</em>, <em class="sig-param">val</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Save" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Save">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Save</code><span class="sig-paren">(</span><em class="sig-param">value</em>, <em class="sig-param">filename_prefix</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Save"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Save" title="Permalink to this definition">¶</a></dt>
<dd><p>Saves values of tensors into files.</p>
<dl class="simple">
<dt>Useful for debugging. E.g.,</dt><dd><p>x = … a tf.Tensor …
y = … a tf.Tensor …
z = compute(x, y)
z = Save(z, ‘/path/tmp’, x=x, y=y, z=z)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>value</strong> – A Tensor. Saving happens after this tensor is computed.</p></li>
<li><p><strong>filename_prefix</strong> – Every tensor is saved with this filename prefix.</p></li>
<li><p><strong>**kwargs</strong> – keywords and tensors. Tensors are logged in the sort order of
these keywards.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value is returned.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.HasRank">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasRank</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">expected_rank</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasRank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasRank" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar for asserting that tensor has the expected rank.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetRank">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetRank</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetRank"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetRank" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns tensor’s rank as an int if it’s available, otherwise a Tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>tensor</strong> – The input tensor.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Either an int or a Tensor for the rank of the input tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.HasShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasShape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">expected_shape</em>, <em class="sig-param">ndims=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Syntactic sugar for asserting that tensor has the expected shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – A Tensor.</p></li>
<li><p><strong>expected_shape</strong> – A Python list or a 1D tensor.</p></li>
<li><p><strong>ndims</strong> – If not None, check only the first <code class="xref py py-obj docutils literal notranslate"><span class="pre">ndims</span></code> dimensions of <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code>.
Must be equal to the length of <code class="xref py py-obj docutils literal notranslate"><span class="pre">expected_shape</span></code> if not None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The input <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code></p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>A runtime error if the assertion fails.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetShape</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">ndims=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns tensor’s shape as a list which can be unpacked, unlike tf.shape.</p>
<p>Tries to return static shape if it’s available. Note that this means
some of the outputs will be ints while the rest will be Tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – The input tensor.</p></li>
<li><p><strong>ndims</strong> – If not None, returns the shapes for the first <code class="xref py py-obj docutils literal notranslate"><span class="pre">ndims</span></code> dimensions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetSize">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetSize</code><span class="sig-paren">(</span><em class="sig-param">tensor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetSize" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.use_xla">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">use_xla</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#use_xla"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.use_xla" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.use_tpu">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">use_tpu</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#use_tpu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.use_tpu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.nas_run">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">nas_run</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#nas_run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.nas_run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.tpu_compat">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">tpu_compat</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#tpu_compat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.tpu_compat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.use_resource_variables">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">use_resource_variables</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#use_resource_variables"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.use_resource_variables" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.outside_all_rewrites">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">outside_all_rewrites</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#outside_all_rewrites"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.outside_all_rewrites" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils._ThreadLocalStack">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_ThreadLocalStack</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_ThreadLocalStack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._ThreadLocalStack" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">_thread._local</span></code></p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.RunOnTpuHost">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RunOnTpuHost</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RunOnTpuHost"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RunOnTpuHost" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the given function call on TPU host.</p>
<p>Invokes func(*args, **kwargs) directly if not running on tpu.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – the function to invoke.</p></li>
<li><p><strong>*args</strong> – args of func</p></li>
<li><p><strong>**kwargs</strong> – kwargs of func</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The function return value.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.tpu_host">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">tpu_host</code><span class="sig-paren">(</span><em class="sig-param">func</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#tpu_host"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.tpu_host" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a python function to only run on TPU hosts.</p>
<p>This function has no effect when running on CPU/GPU.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@py_utils</span><span class="o">.</span><span class="n">tpu_host</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">ComputeWER</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># Call a custom op computing WER.</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>func</strong> – the function to invoke</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TPU-host only function</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SetTpuDeviceAssignment">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SetTpuDeviceAssignment</code><span class="sig-paren">(</span><em class="sig-param">tpu_device_assignment</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SetTpuDeviceAssignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SetTpuDeviceAssignment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ClearTpuDevice">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ClearTpuDevice</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ClearTpuDevice"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ClearTpuDevice" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetTpuDeviceAssignment">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetTpuDeviceAssignment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetTpuDeviceAssignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetTpuDeviceAssignment" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SessionConfig">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SessionConfig</code><span class="sig-paren">(</span><em class="sig-param">soft_placement=True</em>, <em class="sig-param">inline=True</em>, <em class="sig-param">cluster_def=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SessionConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SessionConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a session config proto.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>soft_placement</strong> – Turns allow_soft_placement on iff True.</p></li>
<li><p><strong>inline</strong> – Turns do_function_inlining on iff True.</p></li>
<li><p><strong>cluster_def</strong> – A tf.train.ClusterDef describing the cluster.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A TF session config proto.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Transform">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Transform</code><span class="sig-paren">(</span><em class="sig-param">v</em>, <em class="sig-param">fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Replaces every nested value x in ‘v’ with fn(x) and returns the result.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Pack">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Pack</code><span class="sig-paren">(</span><em class="sig-param">tmpl</em>, <em class="sig-param">values</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Pack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Pack" title="Permalink to this definition">¶</a></dt>
<dd><p>Packs ‘values’ according to ‘tmpl’.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Flatten">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Flatten</code><span class="sig-paren">(</span><em class="sig-param">x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Flatten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Flattens ‘x’ by extracting tensors from nested structures to a list.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.IsCompatible">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">IsCompatible</code><span class="sig-paren">(</span><em class="sig-param">lhs</em>, <em class="sig-param">rhs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#IsCompatible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.IsCompatible" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if lhs and rhs are compatible.</p>
</dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils.NestedMap">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">NestedMap</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/stdtypes.html#dict" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a></p>
<p>A simple helper to maintain a dict.</p>
<dl class="simple">
<dt>It is a sub-class of dict with the following extensions/restrictions:</dt><dd><ul class="simple">
<li><p>It supports attr access to its members (see examples below).</p></li>
<li><p>Member keys have to be valid identifiers.</p></li>
</ul>
</dd>
</dl>
<p>E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="n">NestedMap</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">foo</span><span class="o">.</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">foo</span><span class="o">.</span><span class="n">y</span>
</pre></div>
</div>
<dl class="attribute">
<dt id="lingvo.core.py_utils.NestedMap._HAS_DYNAMIC_ATTRIBUTES">
<code class="sig-name descname">_HAS_DYNAMIC_ATTRIBUTES</code><em class="property"> = True</em><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._HAS_DYNAMIC_ATTRIBUTES" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="lingvo.core.py_utils.NestedMap._RESERVED_KEYS">
<code class="sig-name descname">_RESERVED_KEYS</code><em class="property"> = {'__class__', '__contains__', '__delattr__', '__delitem__', '__dir__', '__doc__', '__eq__', '__format__', '__ge__', '__getattribute__', '__getitem__', '__gt__', '__hash__', '__init__', '__init_subclass__', '__iter__', '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__', '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__sizeof__', '__str__', '__subclasshook__', 'clear', 'copy', 'fromkeys', 'get', 'items', 'keys', 'pop', 'popitem', 'setdefault', 'update', 'values'}</em><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._RESERVED_KEYS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.copy">
<code class="sig-name descname">copy</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; a shallow copy of D<a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.copy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.copy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.DeepCopy">
<code class="sig-name descname">DeepCopy</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.DeepCopy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.DeepCopy" title="Permalink to this definition">¶</a></dt>
<dd><p>Deep-copies the structure but not the leaf objects.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.FromNestedDict">
<em class="property">static </em><code class="sig-name descname">FromNestedDict</code><span class="sig-paren">(</span><em class="sig-param">a_dict</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FromNestedDict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FromNestedDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a nested dict to a NestedMap.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.CheckKey">
<em class="property">static </em><code class="sig-name descname">CheckKey</code><span class="sig-paren">(</span><em class="sig-param">key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.CheckKey"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.CheckKey" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that key is valid NestedMap key.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Flatten">
<code class="sig-name descname">Flatten</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Flatten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Flatten" title="Permalink to this definition">¶</a></dt>
<dd><p>Flatten the <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> and returns values in a list.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.FlattenItems">
<code class="sig-name descname">FlattenItems</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FlattenItems"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FlattenItems" title="Permalink to this definition">¶</a></dt>
<dd><p>Flatten the <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> and returns &lt;key, value&gt; pairs in a list.</p>
<p>For lists, keys will be returned with <code class="xref py py-obj docutils literal notranslate"><span class="pre">_</span></code> appended, e.g. <code class="xref py py-obj docutils literal notranslate"><span class="pre">x.y_10.z</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A list of &lt;key, value&gt; pairs, where keys for nested entries will be
represented in the form of <code class="xref py py-obj docutils literal notranslate"><span class="pre">foo.bar</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.GetItem">
<code class="sig-name descname">GetItem</code><span class="sig-paren">(</span><em class="sig-param">key</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.GetItem"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.GetItem" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value for the nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">key</span></code>.</p>
<p>Note that indexing lists is not supported, names with underscores will be
considered as one key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> – str of the form
<code class="xref py py-obj docutils literal notranslate"><span class="pre">([A-Za-z_][A-Za-z0-9_]*)(.[A-Za-z_][A-Za-z0-9_]*)*.</span></code>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value for the given nested key.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>KeyError if a key is not present.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Get">
<code class="sig-name descname">Get</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">default=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Get" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the value for nested <code class="xref py py-obj docutils literal notranslate"><span class="pre">key</span></code>, returns <code class="xref py py-obj docutils literal notranslate"><span class="pre">default</span></code> if key does not exist.</p>
<p>Note that indexing lists is not supported, names with underscores will be
considered as one key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – str of the form
<code class="xref py py-obj docutils literal notranslate"><span class="pre">([A-Za-z_][A-Za-z0-9_]*)(.[A-Za-z_][A-Za-z0-9_]*)*.</span></code>.</p></li>
<li><p><strong>default</strong> – Optional default value, defaults to None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The value for the given nested key or <code class="xref py py-obj docutils literal notranslate"><span class="pre">default</span></code> if the key does not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Set">
<code class="sig-name descname">Set</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">value</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Set"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Set" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the value for a nested key, returns <code class="xref py py-obj docutils literal notranslate"><span class="pre">default</span></code> if key does not exist.</p>
<p>Note that indexing lists is not supported, names with underscores will be
considered as one key.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> – str of the form
<code class="xref py py-obj docutils literal notranslate"><span class="pre">([A-Za-z_][A-Za-z0-9_]*)(.[A-Za-z_][A-Za-z0-9_]*)*.</span></code>.</p></li>
<li><p><strong>value</strong> – The value to insert.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>ValueError if a sub key is not a NestedMap</strong><strong> or </strong><strong>dict.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Transform">
<code class="sig-name descname">Transform</code><span class="sig-paren">(</span><em class="sig-param">fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Transform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Transform" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with fn applied on each value.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Filter">
<code class="sig-name descname">Filter</code><span class="sig-paren">(</span><em class="sig-param">fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Filter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with entries that fn(entry) is True.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.FilterKeyVal">
<code class="sig-name descname">FilterKeyVal</code><span class="sig-paren">(</span><em class="sig-param">fn</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.FilterKeyVal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.FilterKeyVal" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with filtered by fn.</p>
<p>If fn(key, entry) is True, the entry is copied into the returned NestedMap.
Otherwise, it is not copied.
For lists, keys will be processed with indices, e.g. <code class="xref py py-obj docutils literal notranslate"><span class="pre">x.y[10].z</span></code>.
This is different from FlattenItems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>fn</strong> – a callable of (string, entry)-&gt;boolean.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> contains copied entries from this <code class="xref py py-obj docutils literal notranslate"><span class="pre">'.NestedMap</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.Pack">
<code class="sig-name descname">Pack</code><span class="sig-paren">(</span><em class="sig-param">lst</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.Pack"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.Pack" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a copy of this with each value replaced by a value in lst.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.IsCompatible">
<code class="sig-name descname">IsCompatible</code><span class="sig-paren">(</span><em class="sig-param">other</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.IsCompatible"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.IsCompatible" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns true if self and other are compatible.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> – Another <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.  If x and y are two compatible <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">x.Pack(y.Flatten())</span></code> produces y and <code class="xref py py-obj docutils literal notranslate"><span class="pre">y.Pack(x.Flatten())</span></code> produces x.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap._ToStrings">
<code class="sig-name descname">_ToStrings</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap._ToStrings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap._ToStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns debug strings in a list for this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.DebugString">
<code class="sig-name descname">DebugString</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.DebugString"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.DebugString" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a debug string for this <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.NestedMap.VLog">
<code class="sig-name descname">VLog</code><span class="sig-paren">(</span><em class="sig-param">level=None</em>, <em class="sig-param">prefix=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NestedMap.VLog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NestedMap.VLog" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs the debug string at the level.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils._Unique">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_Unique</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_Unique"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._Unique" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A helper to uniqify variables in a NestedMap.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ToUniqueList">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToUniqueList</code><span class="sig-paren">(</span><em class="sig-param">nmap</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToUniqueList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToUniqueList" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the flattened <code class="xref py py-obj docutils literal notranslate"><span class="pre">nmap</span></code> with duplicates removed.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ReadOnlyAttrDictView">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReadOnlyAttrDictView</code><span class="sig-paren">(</span><em class="sig-param">backing</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReadOnlyAttrDictView"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReadOnlyAttrDictView" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps a dict to provide a read-only view of its contents.</p>
<p>Dict keys can also be accessed by attribute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>backing</strong> – Dict-like object to wrap.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Read-only Mapping that can be accessed by index ([‘foo’]) or attr (d.foo).</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ToStaticShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToStaticShape</code><span class="sig-paren">(</span><em class="sig-param">shape</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToStaticShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToStaticShape" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts ‘shape’ to a static shape.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Zeros">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Zeros</code><span class="sig-paren">(</span><em class="sig-param">shape</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Zeros" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils.UniformSampler">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UniformSampler</code><span class="sig-paren">(</span><em class="sig-param">num_samples</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UniformSampler"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>A reservoir sampler.</p>
<p>This class implements reservoir sampling: Given a limit of <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_samples</span></code> total
samples, this class maintains a uniform probability (1 / <code class="xref py py-obj docutils literal notranslate"><span class="pre">num_samples</span></code>) of
keeping any item dynamically added to the sampler.</p>
<p>See <a class="reference external" href="https://en.wikipedia.org/wiki/Reservoir_sampling">https://en.wikipedia.org/wiki/Reservoir_sampling</a> for details.</p>
<dl class="method">
<dt id="lingvo.core.py_utils.UniformSampler.Add">
<code class="sig-name descname">Add</code><span class="sig-paren">(</span><em class="sig-param">item</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UniformSampler.Add"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler.Add" title="Permalink to this definition">¶</a></dt>
<dd><p>Add item to sampler.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.UniformSampler.samples">
<em class="property">property </em><code class="sig-name descname">samples</code><a class="headerlink" href="#lingvo.core.py_utils.UniformSampler.samples" title="Permalink to this definition">¶</a></dt>
<dd><p>Fetch the current samples from the sampler.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils.RNNCellStateInit">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RNNCellStateInit</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>State initialization functions for RNN cell init state.</p>
<dl class="method">
<dt id="lingvo.core.py_utils.RNNCellStateInit._Params">
<em class="property">static </em><code class="sig-name descname">_Params</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">seed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit._Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit._Params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.RNNCellStateInit.Zeros">
<em class="property">static </em><code class="sig-name descname">Zeros</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit.Zeros"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit.Zeros" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.zeros().</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.RNNCellStateInit.RandomNormal">
<em class="property">static </em><code class="sig-name descname">RandomNormal</code><span class="sig-paren">(</span><em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RNNCellStateInit.RandomNormal"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RNNCellStateInit.RandomNormal" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.random.normal().</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.DefaultRNNCellStateInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefaultRNNCellStateInit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefaultRNNCellStateInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefaultRNNCellStateInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.InitRNNCellState">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">InitRNNCellState</code><span class="sig-paren">(</span><em class="sig-param">shape</em>, <em class="sig-param">init=None</em>, <em class="sig-param">dtype=None</em>, <em class="sig-param">name=None</em>, <em class="sig-param">is_eval=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#InitRNNCellState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.InitRNNCellState" title="Permalink to this definition">¶</a></dt>
<dd><p>Initial state definitions for RNN cell implementations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>shape</strong> – A array of ints/symbols for specifying the shape of the state.</p></li>
<li><p><strong>init</strong> – Hyperparameters as returned by one of the static implemetaitons in
RNNCellStateInit.</p></li>
<li><p><strong>dtype</strong> – The dype of the states. Defaults to tf.float32.</p></li>
<li><p><strong>name</strong> – An optional name for the operation.</p></li>
<li><p><strong>is_eval</strong> – Bool, set to True if we need special behavior in eval mode.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor of the specified shape, and sampled from the distribution as
defined by the init parameters.</p>
</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils.WeightInit">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightInit</code><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Static class providing weight initialization config params.</p>
<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit._Params">
<em class="property">static </em><code class="sig-name descname">_Params</code><span class="sig-paren">(</span><em class="sig-param">method</em>, <em class="sig-param">scale</em>, <em class="sig-param">seed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit._Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit._Params" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.Gaussian">
<em class="property">static </em><code class="sig-name descname">Gaussian</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Gaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Gaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_normal(0, 1.0).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.Uniform">
<em class="property">static </em><code class="sig-name descname">Uniform</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Uniform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Uniform" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_uniform(-1.0, 1.0).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.UniformPositive">
<em class="property">static </em><code class="sig-name descname">UniformPositive</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformPositive"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformPositive" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_uniform(0., 1.0).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.Xavier">
<em class="property">static </em><code class="sig-name descname">Xavier</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Xavier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Xavier" title="Permalink to this definition">¶</a></dt>
<dd><p>Xavier initialization (x = sqrt(6. / (in + out)); [-x, x]).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.XavierWithFixupParams">
<em class="property">static </em><code class="sig-name descname">XavierWithFixupParams</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">depth=1.0</em>, <em class="sig-param">layers_per_residual_block=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.XavierWithFixupParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.XavierWithFixupParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Xavier initialization with Fixup.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.GeoMeanXavier">
<em class="property">static </em><code class="sig-name descname">GeoMeanXavier</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GeoMeanXavier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GeoMeanXavier" title="Permalink to this definition">¶</a></dt>
<dd><p>A variant of Xavier (x = sqrt(3. / sqrt(in * out)); [-x, x]).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.Constant">
<em class="property">static </em><code class="sig-name descname">Constant</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.Constant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.Constant" title="Permalink to this definition">¶</a></dt>
<dd><p>scale.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussian">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussian</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussian" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.truncated_normal(0, 1.0).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtDim">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtDim</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_normal(0, 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtFanIn">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtFanIn</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtFanIn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtFanIn" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_normal(0, 1 / sqrt(fan_in)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.GaussianSqrtFanOut">
<em class="property">static </em><code class="sig-name descname">GaussianSqrtFanOut</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.GaussianSqrtFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.GaussianSqrtFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.random_normal(0, 1 / sqrt(fan_out)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.UniformSqrtDim">
<em class="property">static </em><code class="sig-name descname">UniformSqrtDim</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.uniform(-1 / sqrt(dim0), 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.UniformUnitScaling">
<em class="property">static </em><code class="sig-name descname">UniformUnitScaling</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.UniformUnitScaling"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.UniformUnitScaling" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * sqrt(3) / sqrt(dim0) * tf.uniform(-1, 1).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtDim">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtDim</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtDim" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.truncated_normal(0, 1 / sqrt(dim0)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanIn">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtFanIn</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtFanIn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanIn" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.truncated_normal(0, 1 / sqrt(fan_in)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanOut">
<em class="property">static </em><code class="sig-name descname">TruncatedGaussianSqrtFanOut</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.TruncatedGaussianSqrtFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.TruncatedGaussianSqrtFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>scale * tf.truncated_normal(0, 1 / sqrt(fan_out)).</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.KaimingUniformFanInRelu">
<em class="property">static </em><code class="sig-name descname">KaimingUniformFanInRelu</code><span class="sig-paren">(</span><em class="sig-param">scale=1.0</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.KaimingUniformFanInRelu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.KaimingUniformFanInRelu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.core.py_utils.WeightInit.KaimingUniformFanInLeakyRelu">
<em class="property">static </em><code class="sig-name descname">KaimingUniformFanInLeakyRelu</code><span class="sig-paren">(</span><em class="sig-param">scale=2.23606797749979</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightInit.KaimingUniformFanInLeakyRelu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightInit.KaimingUniformFanInLeakyRelu" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.DefaultParamInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DefaultParamInit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DefaultParamInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DefaultParamInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.IsDefaultParamInit">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">IsDefaultParamInit</code><span class="sig-paren">(</span><em class="sig-param">p</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#IsDefaultParamInit"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.IsDefaultParamInit" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.WeightParams">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightParams</code><span class="sig-paren">(</span><em class="sig-param">shape</em>, <em class="sig-param">init=None</em>, <em class="sig-param">dtype=None</em>, <em class="sig-param">collections=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a hyperparams for a weight variable given the shape/init/dtype.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.FindNeeded">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindNeeded</code><span class="sig-paren">(</span><em class="sig-param">endpoints</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindNeeded"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindNeeded" title="Permalink to this definition">¶</a></dt>
<dd><p>List names of tensors and operations required to compute endpoints.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.FindNeededInList">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindNeededInList</code><span class="sig-paren">(</span><em class="sig-param">tensor_list</em>, <em class="sig-param">endpoints</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindNeededInList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindNeededInList" title="Permalink to this definition">¶</a></dt>
<dd><p>Return tensors from tensor_list needed to compute any of endpoints.</p>
</dd></dl>

<dl class="class">
<dt id="lingvo.core.py_utils._CollectionGetter">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_CollectionGetter</code><span class="sig-paren">(</span><em class="sig-param">key</em>, <em class="sig-param">default_factory</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_CollectionGetter"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._CollectionGetter" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3.7/library/functions.html#object" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Get graph local value from a defined collection.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.OpportunisticVariableReuseScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OpportunisticVariableReuseScope</code><span class="sig-paren">(</span><em class="sig-param">enable_opportunistic_reuse=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OpportunisticVariableReuseScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OpportunisticVariableReuseScope" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetOpportunisticVariableReuse">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetOpportunisticVariableReuse</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetOpportunisticVariableReuse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetOpportunisticVariableReuse" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current variable reuse setting.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.VariableRenameScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariableRenameScope</code><span class="sig-paren">(</span><em class="sig-param">renames</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariableRenameScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariableRenameScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Append the renaming rules to the stack of renames.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>renames</strong> – pairs of (regexp, new_name_format). If the regexp matches, the
new_name_format will be interpolated using the matched groups.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>scope in which the renaming rules are applied</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetVariableName">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetVariableName</code><span class="sig-paren">(</span><em class="sig-param">name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetVariableName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetVariableName" title="Permalink to this definition">¶</a></dt>
<dd><p>Get variable name after application of all renaming rules.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name</strong> – untransformed variable name with scope_name prepended</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>name possibly modified using renaming rules</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GenerateSeedFromName">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GenerateSeedFromName</code><span class="sig-paren">(</span><em class="sig-param">name</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GenerateSeedFromName"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GenerateSeedFromName" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a random seed from a name string.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.VariableShapePrefixContext">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariableShapePrefixContext</code><span class="sig-paren">(</span><em class="sig-param">shape_prefix</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariableShapePrefixContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariableShapePrefixContext" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a shape prefix to variable created by CreateVariable().</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>shape_prefix</strong> – a positive integer of shape prefix.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>None.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetVariableShapePrefixes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetVariableShapePrefixes</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetVariableShapePrefixes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetVariableShapePrefixes" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the list of shape prefixes for CreateVariable().</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetFanInFanOut">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetFanInFanOut</code><span class="sig-paren">(</span><em class="sig-param">shape</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetFanInFanOut"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetFanInFanOut" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns (fan_in, fan_out) of a weight variable of the give shape.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CreateVariable">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CreateVariable</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">params</em>, <em class="sig-param">reuse=None</em>, <em class="sig-param">trainable=True</em>, <em class="sig-param">init_wrapper=None</em>, <em class="sig-param">collections=None</em>, <em class="sig-param">default_seed=None</em>, <em class="sig-param">synchronization=&lt;VariableSynchronization.AUTO: 0&gt;</em>, <em class="sig-param">aggregation=&lt;VariableAggregation.NONE: 0&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CreateVariable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CreateVariable" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates tf.Variable according to param_config.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>name</strong> – A string, name of the variable.</p></li>
<li><p><strong>params</strong> – A WeightParams specifying the details of how this variable should be
constructed and initialized.</p></li>
<li><p><strong>reuse</strong> – Whether or not to reuse an existing variable. It has the same
semantics as the reuse arg in tf.variable_scope.</p></li>
<li><p><strong>trainable</strong> – Whether or not the variable is trainable.</p></li>
<li><p><strong>init_wrapper</strong> – a callback which takes a tf initializer callable and returns a
tensor. It is used when shape of the variable isn’t statically
determinable.</p></li>
<li><p><strong>collections</strong> – Override the default variable collection (
tf.GraphKeys.GLOBAL_VARIABLES).</p></li>
<li><p><strong>default_seed</strong> – Seed to use for initialization if not specified in params.
Used for deterministic initialization in tests.</p></li>
<li><p><strong>synchronization</strong> – Indicates when a distributed a variable will be aggregated.
Accepted values are constants defined in the class
tf.VariableSynchronization. By default the synchronization is set to AUTO
and the current DistributionStrategy chooses when to synchronize.</p></li>
<li><p><strong>aggregation</strong> – Indicates how a distributed variable will be aggregated.
Accepted values are constants defined in the class tf.VariableAggregation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tf.identity(var), var pair. The tf.identity() node is colocated
with var. In the case of FLAGS.no_identity_on_vars, simply returns
a var, var pair.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetGlobalVariableScope">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetGlobalVariableScope</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetGlobalVariableScope"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetGlobalVariableScope" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets the global variable scope (as if no variable_scope has been set).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The VariableScope corresponding to as if no tf.variable_scope is in effect.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GlobalStepContext">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GlobalStepContext</code><span class="sig-paren">(</span><em class="sig-param">global_step_tensor</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GlobalStepContext"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GlobalStepContext" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetGlobalStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetGlobalStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetGlobalStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetGlobalStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the global_step.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetOrCreateGlobalStepVar">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetOrCreateGlobalStepVar</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetOrCreateGlobalStepVar"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetOrCreateGlobalStepVar" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the global_step variable, creating it if it does not exist.</p>
<p>Prefer GetGlobalStep if a tensor rather than a tf.Variable is sufficient.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>The global_step variable, or a new created one if it does not exist.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.LogMultiLines">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">LogMultiLines</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">lines</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#LogMultiLines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.LogMultiLines" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._LogPlacement">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_LogPlacement</code><span class="sig-paren">(</span><em class="sig-param">label</em>, <em class="sig-param">theta</em>, <em class="sig-param">copy</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_LogPlacement"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._LogPlacement" title="Permalink to this definition">¶</a></dt>
<dd><p>Logs theta and its copy’s device placement.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CreateLocalTheta">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CreateLocalTheta</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">device_list=None</em>, <em class="sig-param">label=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CreateLocalTheta"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CreateLocalTheta" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates local copy of theta and shards across devices device list.</p>
<p>Leaves variables intact.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of variables.</p></li>
<li><p><strong>device_list</strong> – list of devices to shard across. If None, defaults to a list
[‘’].</p></li>
<li><p><strong>label</strong> – Logging label.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of identity() wrapped theta</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._GetVarsToLoad">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetVarsToLoad</code><span class="sig-paren">(</span><em class="sig-param">all_vars</em>, <em class="sig-param">variable_loading_rules</em>, <em class="sig-param">var_ignore_rules</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetVarsToLoad"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetVarsToLoad" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines variables to load and their names in checkpoint.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.OverrideVarsFromCheckpoint">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OverrideVarsFromCheckpoint</code><span class="sig-paren">(</span><em class="sig-param">sess</em>, <em class="sig-param">all_vars</em>, <em class="sig-param">checkpoint_path</em>, <em class="sig-param">variable_loading_rules</em>, <em class="sig-param">var_ignore_rules</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OverrideVarsFromCheckpoint"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OverrideVarsFromCheckpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>Overrides variables from a provided checkpoint.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.OverrideVarsFromCheckpoints">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">OverrideVarsFromCheckpoints</code><span class="sig-paren">(</span><em class="sig-param">session</em>, <em class="sig-param">all_vars</em>, <em class="sig-param">ckpts_loading_rules</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#OverrideVarsFromCheckpoints"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.OverrideVarsFromCheckpoints" title="Permalink to this definition">¶</a></dt>
<dd><p>Overrides model variables from checkpoints.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>session</strong> – Tensorflow session.</p></li>
<li><p><strong>all_vars</strong> – List of all the parameters in the model.</p></li>
<li><p><strong>ckpts_loading_rules</strong> – A dictionary of checkpoint path: loading rules.
Checkpoint path must be a path to a pretrained model, and loading rules is
expected to be a tuple of two lists. The first consisting of tuples of
strings defining (regex to match parameter names in the model to override,
format string to determine the corresponding var in the checkpoint), and
the second list consisting of a list of regexes to match parameter names
in the model which should not be overridden, even if they match those in
the loading rules.</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if colliding vars exist or loading rules is not a list.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ComputeGradientsSimple">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeGradientsSimple</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">all_vars</em>, <em class="sig-param">grad_aggregation_method</em>, <em class="sig-param">colocate_gradients_with_ops</em>, <em class="sig-param">gate_gradients</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeGradientsSimple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeGradientsSimple" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ComputeTpuEmbeddingGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeTpuEmbeddingGradients</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">activation_dict</em>, <em class="sig-param">tpu_embedding</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeTpuEmbeddingGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeTpuEmbeddingGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a TpuEmbedding SendGradient op.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – The loss to backprop from.</p></li>
<li><p><strong>activation_dict</strong> – String feature -&gt; embedding activations dict.</p></li>
<li><p><strong>tpu_embedding</strong> – TPUEmbedding instance.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._ComputeGradientsTpu">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_ComputeGradientsTpu</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">all_vars</em>, <em class="sig-param">grad_aggregation_method</em>, <em class="sig-param">colocate_gradients_with_ops</em>, <em class="sig-param">gate_gradients</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_ComputeGradientsTpu"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._ComputeGradientsTpu" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients for local loss across whole TPU cluster.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._ComputeGradientsTpuNas">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_ComputeGradientsTpuNas</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">all_vars</em>, <em class="sig-param">grad_aggregation_method</em>, <em class="sig-param">colocate_gradients_with_ops</em>, <em class="sig-param">gate_gradients</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_ComputeGradientsTpuNas"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._ComputeGradientsTpuNas" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients for local loss across whole TPU cluster.</p>
<p>This implementation specializes for the case where weight params maybe used
for different number of times in the forward computation, so that gradients
should be normalized by the actual number of times they are being computed.</p>
<p>TODO(yonghui): Maybe merge this implementation with the _ComputeGradientsTpu
one.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – The loss to backprop from.</p></li>
<li><p><strong>all_vars</strong> – Vars with respect to which gradients are to be computed.</p></li>
<li><p><strong>grad_aggregation_method</strong> – aggregation method to use when calling
tf.gradients.</p></li>
<li><p><strong>colocate_gradients_with_ops</strong> – boolean, whether or not to colocate gradient op
with the original op.</p></li>
<li><p><strong>gate_gradients</strong> – boolean, flag to be passed to tf.gradients.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>gradients to be passed back.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ComputeGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ComputeGradients</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">vmap</em>, <em class="sig-param">grad_aggregation_method=1</em>, <em class="sig-param">colocate_gradients_with_ops=True</em>, <em class="sig-param">gate_gradients=False</em>, <em class="sig-param">compute_gradients_fn=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ComputeGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ComputeGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients of variables in vmap w.r.t loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – A scalar Tensor.</p></li>
<li><p><strong>vmap</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of variables.</p></li>
<li><p><strong>grad_aggregation_method</strong> – Specifies the method used to combine gradient
terms. Accepted values are constants defined in the class
AggregationMethod.</p></li>
<li><p><strong>colocate_gradients_with_ops</strong> – If True, try colocating gradients with the
corresponding op.</p></li>
<li><p><strong>gate_gradients</strong> – If True, add a tuple around the gradients returned for an
operations. This avoids some race conditions.</p></li>
<li><p><strong>compute_gradients_fn</strong> – Function to use to compute gradients. If None, use
default. compute_gradients_fn should have the same signature as this
function, but without the last argument.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>var_grad - a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient). You can view
var_grad as an ordered list of (key, (var, grad)) tuples. Every
key of var_grad exists in vmap. Every variable in vmap that
contributes to loss must exist in var_grad. Every var of var_grad
must exist in vmap.  grad is the corresponding gradient computed
for var. grad is guaranteed to be not None.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.MaskGradients">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MaskGradients</code><span class="sig-paren">(</span><em class="sig-param">var_grad</em>, <em class="sig-param">grad_mask</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MaskGradients"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MaskGradients" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes gradients of non-masked variables in vmap w.r.t loss.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var_grad</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient)</p></li>
<li><p><strong>grad_mask</strong> – A dict of (variable name, mask).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>var_grad - a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, mask * gradient).</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ApplyGradMultiplier">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyGradMultiplier</code><span class="sig-paren">(</span><em class="sig-param">vs_gs_scale</em>, <em class="sig-param">grad_scale=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyGradMultiplier"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyGradMultiplier" title="Permalink to this definition">¶</a></dt>
<dd><p>Scale gradients by grad_scale on same device as corresponding variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vs_gs_scale</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient, scale).</p></li>
<li><p><strong>grad_scale</strong> – If None, each vs_gs entry has the scale. Otherwise, grad_scale
applies to every entry.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient * grad_scale). In particular, if
grad_scale is 0, the result gradient is always 0, even if the input
gradient is inf or nan.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.HasNanOrInfGradient">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">HasNanOrInfGradient</code><span class="sig-paren">(</span><em class="sig-param">var_grads</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#HasNanOrInfGradient"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.HasNanOrInfGradient" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a bool tensor to indicate if <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_grads</span></code> contains NaNs or Infs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>var_grads</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with (var, grad) tuple as the map value.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A bool scalar tensor to indicate if the <code class="xref py py-obj docutils literal notranslate"><span class="pre">var_grads</span></code> contains NaNs or Infs.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ApplyGradNormCliping">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyGradNormCliping</code><span class="sig-paren">(</span><em class="sig-param">vs_gs</em>, <em class="sig-param">norm=1.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyGradNormCliping"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyGradNormCliping" title="Permalink to this definition">¶</a></dt>
<dd><p>Clip gradients to norm on same device as corresponding variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vs_gs</strong> – A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, gradient).</p></li>
<li><p><strong>norm</strong> – Each tensor’s gradient will be scaled down to have a maximum L2-norm
value of <code class="xref py py-obj docutils literal notranslate"><span class="pre">norm</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of (variable, scaled_gradient). In particular, if
grad_scale is 0, the result gradient is always 0, even if the input
gradient is inf or nan.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.AdjustGradientsWithLpLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AdjustGradientsWithLpLoss</code><span class="sig-paren">(</span><em class="sig-param">var_grads</em>, <em class="sig-param">lp_regularizer_weight</em>, <em class="sig-param">p=2.0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AdjustGradientsWithLpLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AdjustGradientsWithLpLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Adjusts the map of (var, grad) with Lp regularization, where p=1.0 or 2.0.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>var_grads</strong> – a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or list of (variable, gradient).</p></li>
<li><p><strong>lp_regularizer_weight</strong> – Lp regularization weight.</p></li>
<li><p><strong>p</strong> – For now we support 1.0 or 2.0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple (lp_loss, var_grads).</p>
<ul class="simple">
<li><p>lp_loss: A scalar. The lp loss.</p></li>
<li><p>var_grads: a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or list of (variable, gradient) regulated by Lp.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SplitRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SplitRecursively</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">num_splits</em>, <em class="sig-param">axis=-1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SplitRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SplitRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits Tensors in ‘x’ recursively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – a Tensor, or a list or NestMap containing Tensors to split.</p></li>
<li><p><strong>num_splits</strong> – number of splits per Tensor.</p></li>
<li><p><strong>axis</strong> – the split axis.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A list of split values of length ‘num_splits’.</p>
<ul class="simple">
<li><p>If ‘x’ is a Tensor, a list of split Tensors.</p></li>
<li><p>If ‘x’ is a list, a list of lists, where each sublist has the same length
as ‘x’ and the k’th element in each sublist corresponds to a split of the
k’th element from ‘x’.</p></li>
<li><p>If ‘x’ is a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, where each field
corresponds to a split from the same field of ‘x’.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ConcatRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatRecursively</code><span class="sig-paren">(</span><em class="sig-param">splits</em>, <em class="sig-param">axis=-1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates tensors from ‘splits’.</p>
<p>This is the inverse function of SplitRecursively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>splits</strong> – a list of splits to concatenate, where elements can be Tensors,
lists, or <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>. The elements must share the same type and
structure.  For example, list elements must have the same length;
<a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> must have the same set of fields.</p></li>
<li><p><strong>axis</strong> – the concatenation axis.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Concatenated data.</p>
<ul class="simple">
<li><p>If input ‘splits’ are Tensors, returns a concatenated Tensor.</p></li>
<li><p>If input ‘splits’ are lists, returns a list of the same length where the
k’th element represents concatenated data of the k’th element from each
split.</p></li>
<li><p>If input ‘splits’ are <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>, returns a <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with each field
concatenated from corresponding fields of input splits.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#TypeError" title="(in Python v3.7)"><strong>TypeError</strong></a> – if ‘splits’ is not a list or elements of ‘splits’ do not have
    known or matching types.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if ‘splits’ is empty or elements of ‘splits’ do not have
    matching structures.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.AddToPruningCollections">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddToPruningCollections</code><span class="sig-paren">(</span><em class="sig-param">weight</em>, <em class="sig-param">mask</em>, <em class="sig-param">threshold</em>, <em class="sig-param">gradient=None</em>, <em class="sig-param">old_weight=None</em>, <em class="sig-param">old_old_weight=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddToPruningCollections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddToPruningCollections" title="Permalink to this definition">¶</a></dt>
<dd><p>Add mask, threshold, and weight vars to their respective collections.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.WeightedAvg">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightedAvg</code><span class="sig-paren">(</span><em class="sig-param">values</em>, <em class="sig-param">weights</em>, <em class="sig-param">sum_reduction_fn=&lt;function reduce_sum_v1&gt;</em>, <em class="sig-param">name=''</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightedAvg"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightedAvg" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes weighted average of values from a tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>values</strong> – a tensor of values</p></li>
<li><p><strong>weights</strong> – a tensor of weights</p></li>
<li><p><strong>sum_reduction_fn</strong> – called to reduce the values and weights to single value</p></li>
<li><p><strong>name</strong> – name of metric.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple (avg, total_weight).</p>
<ul class="simple">
<li><p>avg: weighted average value</p></li>
<li><p>total_weight: sum of all weights</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.WeightedAvgOfMetrics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">WeightedAvgOfMetrics</code><span class="sig-paren">(</span><em class="sig-param">metrics</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#WeightedAvgOfMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.WeightedAvgOfMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes the weighted average of metrics in the list.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>metrics</strong> – list of dictionaries of metrics</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ret_dict - dictionary of weighted averages of each metrics.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ConcatPerExampleTensors">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatPerExampleTensors</code><span class="sig-paren">(</span><em class="sig-param">per_example</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatPerExampleTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatPerExampleTensors" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenate per-example tensors from many hosts into one large block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>per_example</strong> – list of dictionaries of per-example tensors.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ret_dict - string -&gt; concatenated tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CombineMetrics">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CombineMetrics</code><span class="sig-paren">(</span><em class="sig-param">loss_metric_weight_pairs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CombineMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CombineMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Combines metrics from <code class="xref py py-obj docutils literal notranslate"><span class="pre">loss_metric_weight_pairs</span></code> according to weights.</p>
<p>Keys must either exist in all metrics, in which it will be processed as a
weighted sum, or exist in only one metrics, in which case it will be copied.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>loss_metric_weight_pairs</strong> – a list of (metrics, weight) pairs, where each
weight is a float and each metrics is a dict with str keys and
(metric_value, target_weight) values.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A dict with the same set of keys as input metrics and values of
(weighted_sum(metric_value), weighted_sum(target_weight)).</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if there exists a metric that exists in more than one element
    of <code class="xref py py-obj docutils literal notranslate"><span class="pre">loss_metric_weight_pairs</span></code> but not in all of them.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._AddVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_AddVN</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">x</em>, <em class="sig-param">step=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_AddVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._AddVN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.AddGlobalVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddGlobalVN</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">weights</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddGlobalVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddGlobalVN" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds variational noise to weights if specified by params.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.AddPerStepVN">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddPerStepVN</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">weights</em>, <em class="sig-param">step=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddPerStepVN"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddPerStepVN" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds per-setp variational noise to weights if specified by params.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.VariationalNoiseParams">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">VariationalNoiseParams</code><span class="sig-paren">(</span><em class="sig-param">scale</em>, <em class="sig-param">global_vn=False</em>, <em class="sig-param">per_step_vn=False</em>, <em class="sig-param">seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#VariationalNoiseParams"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.VariationalNoiseParams" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a hyperparams for variational noise.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetStepSeed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets step_seed.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ResetStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ResetStepSeed</code><span class="sig-paren">(</span><em class="sig-param">seed=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ResetStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ResetStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets step_seed to specified value.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GetIncStepSeed">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GetIncStepSeed</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GetIncStepSeed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GetIncStepSeed" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns and increments the step_seed.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.GenerateStepSeedPair">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">GenerateStepSeedPair</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">global_step</em>, <em class="sig-param">op_seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#GenerateStepSeedPair"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.GenerateStepSeedPair" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a seed pair for deterministic random operations in functional loops.</p>
<p>This function retrieves a unique seed pair on each call, based off the current
global step and step seed. The step seed ensures this function returns a
unique seed pair on each call: calling this function automatically increments
the step seed. The step seed is automatically reset at the beginning of each
global step in the model’s FProp and works transparently through recurrent.py.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – A hyperparams.Params object, containing keys ‘random_seed’ and
‘is_inference’.</p></li>
<li><p><strong>global_step</strong> – The global step.</p></li>
<li><p><strong>op_seed</strong> – An additional operation-level seed to apply.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A size 2 tensor of op seeds to use for stateless_random ops.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.DeterministicDropout">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">DeterministicDropout</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">keep_prob</em>, <em class="sig-param">seeds</em>, <em class="sig-param">noise_shape=None</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#DeterministicDropout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.DeterministicDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to <code class="xref py py-obj docutils literal notranslate"><span class="pre">tf.nn.dropout()</span></code>, but fully deterministic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A float Tensor on which to apply dropout.</p></li>
<li><p><strong>keep_prob</strong> – A scalar <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of keep probability.</p></li>
<li><p><strong>seeds</strong> – A Tensor of shape [2]. 2 seeds for deterministic random number
generator.</p></li>
<li><p><strong>noise_shape</strong> – A 1-D <code class="xref py py-obj docutils literal notranslate"><span class="pre">Tensor</span></code> of type <code class="xref py py-obj docutils literal notranslate"><span class="pre">int32</span></code>, representing the shape for
randomly generated keep/drop flags.</p></li>
<li><p><strong>name</strong> – An optional name for this operation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor with the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code>.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>InvalidArgumentError</strong> – if keep_prob is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.UpdateBatchNormVars">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateBatchNormVars</code><span class="sig-paren">(</span><em class="sig-param">batch_norm_var</em>, <em class="sig-param">batch_norm_stats</em>, <em class="sig-param">decay</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateBatchNormVars"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateBatchNormVars" title="Permalink to this definition">¶</a></dt>
<dd><p>Update batch normalization moving averages.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.FindRelevantBatchNormUpdates">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FindRelevantBatchNormUpdates</code><span class="sig-paren">(</span><em class="sig-param">loss</em>, <em class="sig-param">batch_norm_updates</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FindRelevantBatchNormUpdates"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FindRelevantBatchNormUpdates" title="Permalink to this definition">¶</a></dt>
<dd><p>Finds and returns a list of relevant batch-normalization updates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>loss</strong> – The loss that is being optimized for. A tensor or a list of tensors.</p></li>
<li><p><strong>batch_norm_updates</strong> – A list of batch normalization updates.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A pair of lists. The first list contains all the batch normalization updates
that are relevant to the loss being optimized, and the second list contains
all in batch_norm_updates but not in the first list.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SampleStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SampleStep</code><span class="sig-paren">(</span><em class="sig-param">step</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SampleStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SampleStep" title="Permalink to this definition">¶</a></dt>
<dd><p>A context for a sample step during decoding.</p>
<p>Example usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">py_utils</span><span class="o">.</span><span class="n">SampleStep</span><span class="p">(</span><span class="n">step</span><span class="p">):</span>
  <span class="n">sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DecodeOneStep</span><span class="p">()</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>step</strong> – the step tensor.</p>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>a context manager for the step scope.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._GetSampleStep">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_GetSampleStep</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_GetSampleStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._GetSampleStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.AddDebugTensor">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">AddDebugTensor</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">summarize=None</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#AddDebugTensor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.AddDebugTensor" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds <code class="xref py py-obj docutils literal notranslate"><span class="pre">tensor</span></code> to the debug collection.</p>
<p>Prints the tensor if <code class="xref py py-obj docutils literal notranslate"><span class="pre">--print_debug_tensors</span></code> is True.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tensor</strong> – A tensor.</p></li>
<li><p><strong>summarize</strong> – Only print this many entries of each tensor. If None, then a
maximum of 3 elements are printed per input tensor.</p></li>
<li><p><strong>name</strong> – An optional name for the tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor that evaluates to the same value as the input tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ArgMax">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ArgMax</code><span class="sig-paren">(</span><em class="sig-param">inputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ArgMax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ArgMax" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.argmax wrapper.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>inputs</strong> – A tensor, whose last dimension is being reduced on.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor of rank tf.rank(logits)-1. If i == ret[indices],
logits[indices, i] is the maximum among logits[indices, :].</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._EnsureMatrixShape">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_EnsureMatrixShape</code><span class="sig-paren">(</span><em class="sig-param">x</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_EnsureMatrixShape"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._EnsureMatrixShape" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Matmul">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Matmul</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">y</em>, <em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Matmul"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Matmul" title="Permalink to this definition">¶</a></dt>
<dd><p>tf.matmul wrapper expecting x and y are actually matrices.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.clip_by_value">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">clip_by_value</code><span class="sig-paren">(</span><em class="sig-param">t</em>, <em class="sig-param">clip_value_min</em>, <em class="sig-param">clip_value_max</em>, <em class="sig-param">name=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#clip_by_value"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.clip_by_value" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._TransformAndSum">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_TransformAndSum</code><span class="sig-paren">(</span><em class="sig-param">tensor_list</em>, <em class="sig-param">transform</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_TransformAndSum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._TransformAndSum" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SumSquared">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SumSquared</code><span class="sig-paren">(</span><em class="sig-param">tensor_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SumSquared"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SumSquared" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SumAbs">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SumAbs</code><span class="sig-paren">(</span><em class="sig-param">tensor_list</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SumAbs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SumAbs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.PiecewiseConstant">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PiecewiseConstant</code><span class="sig-paren">(</span><em class="sig-param">x_in</em>, <em class="sig-param">boundaries</em>, <em class="sig-param">values</em>, <em class="sig-param">vdtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PiecewiseConstant"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PiecewiseConstant" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the piecewise value of x_in.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.PadSequenceDimension">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadSequenceDimension</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">length</em>, <em class="sig-param">pad_val</em>, <em class="sig-param">shape=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadSequenceDimension"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadSequenceDimension" title="Permalink to this definition">¶</a></dt>
<dd><p>Pads x to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code> along the second dim.</p>
<p>Assumes <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> is a tensor with rank &gt;= 2, and it only pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">x</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code>
along the second dim. Explicitly sets the returned tensor shape to <code class="xref py py-obj docutils literal notranslate"><span class="pre">shape</span></code> if
given. Raises runtime errors if x.shape[1] &gt; length or x.shape[i] != shape[i]
where i != 1.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – the tensor to be padded with shape [batch, seq_len, …].</p></li>
<li><p><strong>length</strong> – an int to specify the length to pad x to.</p></li>
<li><p><strong>pad_val</strong> – an int or float used to pad x.</p></li>
<li><p><strong>shape</strong> – an int array specifying the shape of the padded tensor if specified.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The padded tensor with shape [batch, seq_len, …], where
ret[:, :seq_len, …] == x.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.PadSequenceTo">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadSequenceTo</code><span class="sig-paren">(</span><em class="sig-param">xs</em>, <em class="sig-param">padding</em>, <em class="sig-param">length</em>, <em class="sig-param">pad_val</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadSequenceTo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadSequenceTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code> along the 2nd dim.</p>
<p>Pads <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> to <code class="xref py py-obj docutils literal notranslate"><span class="pre">length</span></code> using <code class="xref py py-obj docutils literal notranslate"><span class="pre">pad_val</span></code>, and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding</span></code> using 1.
Raise error if <code class="xref py py-obj docutils literal notranslate"><span class="pre">x.shape[:2]</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">padding.shape</span></code> are not the same.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>xs</strong> – A Tensor or a list of Tensors of shape [batch, seqlen] or [batch,
seqlen, …].</p></li>
<li><p><strong>padding</strong> – A 0/1 Tensor of shape [batch, seqlen]. 1 is for padded locations.</p></li>
<li><p><strong>length</strong> – A Python int, the length to pad to.</p></li>
<li><p><strong>pad_val</strong> – A Python numeric, used for padding x.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple of padded xs and padding.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ApplyPadding">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ApplyPadding</code><span class="sig-paren">(</span><em class="sig-param">padding</em>, <em class="sig-param">x</em>, <em class="sig-param">padded=None</em>, <em class="sig-param">broadcast=True</em>, <em class="sig-param">use_select=True</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ApplyPadding"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ApplyPadding" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies padding to a tensor.</p>
<p>This is preferable to using arithmetic means for masking out padded values
such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Equiv to ApplyPadding(padding, x))</span>
<span class="n">x</span> <span class="o">*=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">padding</span>
<span class="c1"># Equiv to ApplyPadding(padding, new, old)</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">old</span> <span class="o">*</span> <span class="n">padding</span> <span class="o">+</span> <span class="n">new</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">padding</span><span class="p">)</span>
</pre></div>
</div>
<p>Aside from just being easier to read and reason about, using this function
is friendly to quantized representations because it does not mix arithmetic
on the padding values with the values in the tensor being padded (which can
have a very different range than the 0..1 padding tensor).</p>
<p>In addition, this works around issues in quantized schemes where we are
guaranteed to have an exact 0 but not necessarily any other number (i.e. 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>padding</strong> – Tensor of padding values where 0 == keep and 1 == pad.</p></li>
<li><p><strong>x</strong> – Tensor to apply padding to.</p></li>
<li><p><strong>padded</strong> – Optional. Values to include for padded elements. Defaults to zeros.
Must be the same shape as ‘x’ if specified.</p></li>
<li><p><strong>broadcast</strong> – Whether to broadcast the padding shape to the shape of ‘x’. You
almost certainly want this to be true as it matches how padding would be
expanded if applied arithmetically.</p></li>
<li><p><strong>use_select</strong> – Controls whether padding is applied with a select-mask
(True/default) or arithmetically (False). Some platforms have a
sensitivity to one or the other and this is used to work around such
issues.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor with the same shape as x with padded values masked.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.LengthsFromPaddings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">LengthsFromPaddings</code><span class="sig-paren">(</span><em class="sig-param">paddings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#LengthsFromPaddings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.LengthsFromPaddings" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes lengths of each sequence in a batch, ignoring trailing padding.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>paddings</strong> – a tensor with shape [batch, length].</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>lengths tensor shaped [batch] containing the unpadded length of each
sequence in the batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.TrimTrailingPaddings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">TrimTrailingPaddings</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">paddings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#TrimTrailingPaddings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.TrimTrailingPaddings" title="Permalink to this definition">¶</a></dt>
<dd><p>Trims trailing paddings from inputs.</p>
<p>Since the number of dimensions is not fixed, this will not work on TPU.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a tensor with shape [batch, length, …].</p></li>
<li><p><strong>paddings</strong> – a tensor with shape [batch, length].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Trimmed inputs and paddings. For compatibility reasons, the trimmed tensors
will always have length at least 1.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ReversePaddedSequence">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReversePaddedSequence</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">paddings</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReversePaddedSequence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReversePaddedSequence" title="Permalink to this definition">¶</a></dt>
<dd><p>Reverse inputs based on paddings.</p>
<p>Only reverse the unpadded portion of <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code>. It assumes inputs are only
padded in the end.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a tensor of [seq_length, batch_size, num_input_nodes].</p></li>
<li><p><strong>paddings</strong> – a tensor of float32/float64 zero or one of shape [seq_length,
batch_size, 1].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A reversed tensor of the same shape as <code class="xref py py-obj docutils literal notranslate"><span class="pre">inputs</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ConcatenatePaddedSequences">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ConcatenatePaddedSequences</code><span class="sig-paren">(</span><em class="sig-param">input0</em>, <em class="sig-param">input1</em>, <em class="sig-param">padding0</em>, <em class="sig-param">padding1</em>, <em class="sig-param">seq_dim=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ConcatenatePaddedSequences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ConcatenatePaddedSequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Concatenates input sequences with varying lenghts as defined by paddings.</p>
<p>This is a helper function for concatenating 2 batches of input sequences,
where each example in the batch can have different lengths, as defined by
the corresponding paddings. To concatenate correctly, it makes use of
tf.reverse_sequence to partially reverse the sequences before
concatenating them together.</p>
<p>NOTE: We assume that the tensors have no leading paddings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input0</strong> – A tensor of size [batch, max_length, …] or [max_length, batch,
…] depending on the value set for axis.</p></li>
<li><p><strong>input1</strong> – A tensor of size [batch, max_length, …] or [max_length, batch,
…] depending on the value set for axis.</p></li>
<li><p><strong>padding0</strong> – A Tensor of size [batch, max_length] or [max_length, batch]
corresponding to the padding for input0.</p></li>
<li><p><strong>padding1</strong> – A Tensor of size [batch, max_length] or [max_length, batch]
corresponding to the padding for input1.</p></li>
<li><p><strong>seq_dim</strong> – int, the time axis along which the tensors will be concatenated.
Should be 0 or 1. Assumes that batch_dim is 1 - seq_dim.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>The concatenation of input0 and input1, and the corresponding padding.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>tf.errors.InvalidArgumentError when seq_dim is not 0</strong><strong> or </strong><strong>1.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.Retry">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">Retry</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#Retry"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.Retry" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.RetryOnTransientTfError">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RetryOnTransientTfError</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RetryOnTransientTfError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RetryOnTransientTfError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.PadOrTrimTo">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">PadOrTrimTo</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">shape</em>, <em class="sig-param">pad_val=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#PadOrTrimTo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.PadOrTrimTo" title="Permalink to this definition">¶</a></dt>
<dd><p>Pad and slice x to the given shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – A tensor.</p></li>
<li><p><strong>shape</strong> – The shape of the returned tensor.</p></li>
<li><p><strong>pad_val</strong> – An int or float used to pad x.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>‘x’ is padded with pad_val and sliced so that the result has the given
shape.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.RepeatDim">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RepeatDim</code><span class="sig-paren">(</span><em class="sig-param">tensor</em>, <em class="sig-param">multiple</em>, <em class="sig-param">axis</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RepeatDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RepeatDim" title="Permalink to this definition">¶</a></dt>
<dd><p>Copies elements in tensor’s axis “multiple” times, like np.repeat.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.StackTensorsRecursively">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">StackTensorsRecursively</code><span class="sig-paren">(</span><em class="sig-param">values</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#StackTensorsRecursively"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.StackTensorsRecursively" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively stacks Tensors in a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>values</strong> – a list of <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> or Tensors to stacks.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A <a class="reference internal" href="#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> with stacked values or a stacked Tensor.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.MixByWeight">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">MixByWeight</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">weights</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#MixByWeight"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.MixByWeight" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a weighted random choice and bprop type from the give inputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – a list of callables, where each callable returns a tf.Tensor or a
nested structure containing tf.Tensor. Function return types must be
consistent across elements. The tf.Operation to compute the result tensor
will only be invoked for one input at a time. For example, if each fn
represents an input record stream, a record will be drawn only from a
selected stream while the other streams will remain unchanged.</p></li>
<li><p><strong>weights</strong> – a 1D tensor of float &gt; 0 of the same length as inputs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A probablistic sample from the inputs proportional to the weights. The
return type will be the same as return type of individual ‘fn’ from the
inputs.
A one-hot vector of the source selected.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CheckShapes">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CheckShapes</code><span class="sig-paren">(</span><em class="sig-param">shapes</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CheckShapes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CheckShapes" title="Permalink to this definition">¶</a></dt>
<dd><p>Asserts that shapes is a tuple of tshape.Shape.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.FPropDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">FPropDtype</code><span class="sig-paren">(</span><em class="sig-param">params</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#FPropDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.FPropDtype" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.UpdateFpropDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateFpropDtype</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">fprop_dtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateFpropDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateFpropDtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively update the fprop_dtype of the Params.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.UpdateDtype">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">UpdateDtype</code><span class="sig-paren">(</span><em class="sig-param">params</em>, <em class="sig-param">dtype</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#UpdateDtype"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.UpdateDtype" title="Permalink to this definition">¶</a></dt>
<dd><p>Recursively update the dtype of the Params.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.NameScopeDecorator">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">NameScopeDecorator</code><span class="sig-paren">(</span><em class="sig-param">name_scope</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#NameScopeDecorator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.NameScopeDecorator" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a python function to introduce a tf.name_scope.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@py_utils</span><span class="o">.</span><span class="n">NameScopeDecorator</span><span class="p">(</span><span class="s1">&#39;foobar&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">MyFoobarMethod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="c1"># ... Do TF things</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>name_scope</strong> – The name scope to introduce.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A function decorator.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SequencesToDebugStrings">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SequencesToDebugStrings</code><span class="sig-paren">(</span><em class="sig-param">ids</em>, <em class="sig-param">lens</em>, <em class="sig-param">summarize=5</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SequencesToDebugStrings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SequencesToDebugStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns debug strings for the given sequences.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids</strong> – int32 of [batch, len].</p></li>
<li><p><strong>lens</strong> – int32 of [batch].</p></li>
<li><p><strong>summarize</strong> – number of ids to summarize per sequence.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A string tensor of [batch].</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.RematerializeFn">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RematerializeFn</code><span class="sig-paren">(</span><em class="sig-param">fn</em>, <em class="sig-param">*xs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RematerializeFn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RematerializeFn" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls fn and rematerializes fn in the backward pass.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">fn(*xs)</span> <span class="pre">-&gt;</span> <span class="pre">ys</span></code>, where xs and ys can be a single tensor or a tuple of tensors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fn</strong> – A python function to be rematerialized in the backprop pass.</p></li>
<li><p><strong>*xs</strong> – A single tensor or a list/tuple of tensors. <code class="xref py py-obj docutils literal notranslate"><span class="pre">xs</span></code> are input args to the
fn function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><code class="xref py py-obj docutils literal notranslate"><span class="pre">fn(*xs)</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.StatefulRandomOpsInDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">StatefulRandomOpsInDefun</code><span class="sig-paren">(</span><em class="sig-param">func</em>, <em class="sig-param">graph=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#StatefulRandomOpsInDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.StatefulRandomOpsInDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks whether the Defun depends on stateful random number ops.</p>
<p>Stateful random number generator ops should be avoid in Recurrent() call.
Otherwise, these ops produce inconsistent values between FProp and BProp.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> – a _DefinedFunction to check.</p></li>
<li><p><strong>graph</strong> – a Graph. Set None to use the default graph.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of names of the stateful random ops.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>InvalidArgumentError</strong> – if the input func/graph is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ToPlaceholders">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ToPlaceholders</code><span class="sig-paren">(</span><em class="sig-param">nmap</em>, <em class="sig-param">dtype=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ToPlaceholders"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ToPlaceholders" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts every Tensor in nmap to a placeholder.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SoftmaxCrossEntropyFocalLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SoftmaxCrossEntropyFocalLoss</code><span class="sig-paren">(</span><em class="sig-param">logits</em>, <em class="sig-param">label_ids=None</em>, <em class="sig-param">label_probs=None</em>, <em class="sig-param">alpha=None</em>, <em class="sig-param">gamma=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SoftmaxCrossEntropyFocalLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SoftmaxCrossEntropyFocalLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Focal loss for multinomial (softmax) logistic loss.</p>
<p>[1] Focal loss <a class="reference external" href="https://arxiv.org/abs/1708.02002">https://arxiv.org/abs/1708.02002</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – […, C]. Logits for the multinomial logistic regression. C is the
number of classes.</p></li>
<li><p><strong>label_ids</strong> – […]. Each entry in labels must be an index in [0, C).</p></li>
<li><p><strong>label_probs</strong> – […, C]. Each vector along last dimension must be a valid
probability distribution.</p></li>
<li><p><strong>alpha</strong> – [C]. The weighting factor alpha. Eq (3) in [1].</p></li>
<li><p><strong>gamma</strong> – []. Tunable focusing parameter. Eq (4) in [1].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>loss[i…, j] = FL(pₜ) = - αₜ(1-pₜ)ˠlog(pₜ) Eq (5) in [1].</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.SigmoidCrossEntropyFocalLoss">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">SigmoidCrossEntropyFocalLoss</code><span class="sig-paren">(</span><em class="sig-param">logits</em>, <em class="sig-param">labels</em>, <em class="sig-param">alpha=None</em>, <em class="sig-param">gamma=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#SigmoidCrossEntropyFocalLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.SigmoidCrossEntropyFocalLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Focal loss for binary (sigmoid) logistic loss.</p>
<p>[1] Focal loss <a class="reference external" href="https://arxiv.org/abs/1708.02002">https://arxiv.org/abs/1708.02002</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – […, C]. Logits for the sigmoid logistic regression.</p></li>
<li><p><strong>labels</strong> – […, C]. 0/1 labels.</p></li>
<li><p><strong>alpha</strong> – The weighting factor alpha. Eq (3) in [1].</p></li>
<li><p><strong>gamma</strong> – Tunable focusing parameter. Eq (4) in [1].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>loss[i…, j] = FL(pₜ) = - αₜ(1-pₜ)ˠlog(pₜ) Eq (5) in [1].</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.RecordFormatFromFilePattern">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">RecordFormatFromFilePattern</code><span class="sig-paren">(</span><em class="sig-param">file_pattern</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#RecordFormatFromFilePattern"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.RecordFormatFromFilePattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the record format string for a Lingvo file pattern.</p>
<dl class="simple">
<dt>Lingvo file patterns take the form of:</dt><dd><p>tfrecord:/path/to/bar -&gt; tfrecord is the record_format.</p>
</dd>
</dl>
<p>This function takes a file pattern and returns a string indicating
which format the filepattern implies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_pattern</strong> – String file pattern.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>record_format: String record format, e.g., “tfrecord”, etc.</p></li>
<li><p>file_pattern: The file pattern without any prefixes.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>Tuple (string, string)</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ReadFileLines">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ReadFileLines</code><span class="sig-paren">(</span><em class="sig-param">file_path</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ReadFileLines"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ReadFileLines" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a text file and return the lines.</p>
<p>If the file cannot be found at the given path, attempt to load it from the
Lingvo package (useful for data dependencies in par files).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>file_path</strong> – path to file, either absolute or relative to the bazel workspace.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of lines from the file.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CumSum">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CumSum</code><span class="sig-paren">(</span><em class="sig-param">x</em>, <em class="sig-param">axis=0</em>, <em class="sig-param">exclusive=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CumSum"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CumSum" title="Permalink to this definition">¶</a></dt>
<dd><p>A TPU efficient implementation of tf.cumsum().</p>
<p>This is equivalent to tf.cumsum and is faster on TPU as of 08/2019 unless
the axis dimension is very large. The current Tensorflow implementation is
based on scanning and reducing which is not efficient on TPU.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – An input Tensor.</p></li>
<li><p><strong>axis</strong> – An int for the axis.</p></li>
<li><p><strong>exclusive</strong> – A bool for performing exclusive cumsum.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A Tensor of the same shape as x.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – if the input axis is invalid.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.ProjectLastDim">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">ProjectLastDim</code><span class="sig-paren">(</span><em class="sig-param">inputs</em>, <em class="sig-param">weight</em>, <em class="sig-param">input_dim</em>, <em class="sig-param">output_dim</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#ProjectLastDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.ProjectLastDim" title="Permalink to this definition">¶</a></dt>
<dd><p>Linear projection on the last dim of the input tensor.</p>
<p>This is a TPU efficient implementation to avoid reshaping inputs to Rank-2
tensor by using Einsum for the compute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – An input Tensor, the last dimension of which is input_dim.</p></li>
<li><p><strong>weight</strong> – A weight matrix with shape [input_dim, output_dim].</p></li>
<li><p><strong>input_dim</strong> – An integer or a symbolic dim, the last dimension of the inputs.</p></li>
<li><p><strong>output_dim</strong> – An integer or a symbolic dim, the last dimension of the outputs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An output Tensor of the same rank as inputs, the last dimension is
output_dim.</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils._DefineDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">_DefineDefun</code><span class="sig-paren">(</span><em class="sig-param">fwd</em>, <em class="sig-param">bak</em>, <em class="sig-param">args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#_DefineDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils._DefineDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps fwd in a defun with custom gradient bak.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwd</strong> – A callable xs: NestedMap -&gt; ys: NestedMap.</p></li>
<li><p><strong>bak</strong> – A callable xs, ys, dys: NestedMap -&gt; dxs: NestedMap. The custom
backprop function for fwd.</p></li>
<li><p><strong>args</strong> – A NestedMap of tf.Tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>defun: A tf.Defun wraps fwd
args:  A NestedMap of tf.DType
rets:  A NestedMap of tf.DType</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A NestedMap w/ fields</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="lingvo.core.py_utils.CallDefun">
<code class="sig-prename descclassname">lingvo.core.py_utils.</code><code class="sig-name descname">CallDefun</code><span class="sig-paren">(</span><em class="sig-param">fwd</em>, <em class="sig-param">bak</em>, <em class="sig-param">args</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/py_utils.html#CallDefun"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.py_utils.CallDefun" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps fwd in a defun with custom gradient bak and calls it with args.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fwd</strong> – A callable xs: NestedMap -&gt; ys: NestedMap.</p></li>
<li><p><strong>bak</strong> – A callable xs, ys, dys: NestedMap -&gt; dxs: NestedMap. The custom
backprop function for fwd.</p></li>
<li><p><strong>args</strong> – A NestedMap of tf.Tensor.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A NestedMap equivalent to what fwd(args) computes.</p>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.quant_utils.html" class="btn btn-neutral float-right" title="lingvo.core.quant_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.program.html" class="btn btn-neutral float-left" title="lingvo.core.program module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>