

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.tasks.asr.decoder module &mdash; Lingvo  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.tasks.asr.decoder_utils module" href="lingvo.tasks.asr.decoder_utils.html" />
    <link rel="prev" title="lingvo.tasks.asr.contextualizer_base module" href="lingvo.tasks.asr.contextualizer_base.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.tasks.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.html">lingvo.tasks package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.asr.html">lingvo.tasks.asr package</a> &raquo;</li>
        
      <li>lingvo.tasks.asr.decoder module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.tasks.asr.decoder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.tasks.asr.decoder">
<span id="lingvo-tasks-asr-decoder-module"></span><h1>lingvo.tasks.asr.decoder module<a class="headerlink" href="#module-lingvo.tasks.asr.decoder" title="Permalink to this headline">¶</a></h1>
<p>Decoders for the speech model.</p>
<dl class="function">
<dt id="lingvo.tasks.asr.decoder._ToTensorArray">
<code class="sig-prename descclassname">lingvo.tasks.asr.decoder.</code><code class="sig-name descname">_ToTensorArray</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">v</em>, <em class="sig-param">max_seq_length</em>, <em class="sig-param">clear_after_read=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_ToTensorArray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._ToTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TensorArray from v, of size max_seq_length.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.tasks.asr.decoder._NewTensorArray">
<code class="sig-prename descclassname">lingvo.tasks.asr.decoder.</code><code class="sig-name descname">_NewTensorArray</code><span class="sig-paren">(</span><em class="sig-param">name</em>, <em class="sig-param">max_seq_length</em>, <em class="sig-param">dtype=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_NewTensorArray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._NewTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create empty TensorArray which can store max_seq_length elements.</p>
</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.asr.decoder.</code><code class="sig-name descname">AsrDecoderBase</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_decoder.html#lingvo.core.base_decoder.BaseBeamSearchDecoder" title="lingvo.core.base_decoder.BaseBeamSearchDecoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_decoder.BaseBeamSearchDecoder</span></code></a></p>
<p>Base class for RNN-with-attention speech decoders.</p>
<p>The decoder takes encoder_outputs, a NestedMap generated by the encoder, as
input. The NestedMap is expected to contain the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><p>‘encoded’: encoded features</p></li>
<li><p>‘padding’: padding for encoded features</p></li>
</ul>
</div></blockquote>
<p>The decoder operates in a ‘step-by-step’ fashion. The model encapsulates all
information which should persist from one step to the next in the
DecoderStepState NestedMap, which provides a ‘misc_states’ NestedMap which can
store arbitrary information required by the specific decoder sub-class.</p>
<p>A ‘step’ in training consists of the following sequence of steps which compute
the outputs from the decoder given the current input target (and the state of
the model after making the previous predictions):</p>
<ol class="arabic">
<li><p>Compute the input target at the current time step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur_target_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TargetsToBeFedAtCurrentDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Update state and compute outputs by running SingleDecodeStep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">step_outs</span><span class="p">,</span> <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SingleDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Update state based on the logits computed at this step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PostStepDecoderStateUpdate</span><span class="p">(</span><span class="n">old_state</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Display summaries based on the accumulated information across all steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">AddAdditionalDecoderSummaries</span><span class="p">(</span><span class="n">seq_out_tas</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Sub-classes can customize behavior by implementing the following functions,
which will modify the behavior of the decoder:</p>
<ul class="simple">
<li><p>GetTargetLabelSequencesWithBeamSearch: Needed for EMBR training.</p></li>
<li><p>_InitBeamSearchStateCallback: Needed by beam search decoder.</p></li>
<li><p>_PreBeamSearchStepCallback</p></li>
<li><p>_PostBeamSearchStepCallback</p></li>
<li><p>MiscZeroState: NestedMap which represents the initial state for the
‘misc_states’ in the DecoderStepState. The default implementation returns
an empty NestedMap.</p></li>
<li><p>SingleDecodeStep: This corresponds to the computation which happens in each
step of the model. The function should return the outputs of the decoder
as well as the updated state.</p></li>
<li><p>PostStepDecoderStateUpdate: A function which updates the DecoderStepState
after the output logits from the decoder have been computed. By default,
this returns the DecoderStepState unchanged.</p></li>
<li><p>TargetsToBeFedAtCurrentDecodeStep: Returns a TargetInfo namedtuple, which
represents information about the targets which should be input at the
current step, as well as the output label which should be predicted.
The default implementation uses the values in the batched ‘targets’
provided by the InputGenerator.</p></li>
<li><p>AddAdditionalDecoderSummaries: A function which can be used to add any
decoder specific information as part of the summaries displayed during
training. By default this is a no-op.</p></li>
<li><p>CreateTargetInfoMisc: A function which can be used to store arbitrary
information as required by a sub-classes in the target info arrays used
to determine the current label at each step during training. By default,
this creates an empty NestedMap.</p></li>
</ul>
<p>A few other functions that control how the decoder initializes and computes
attention during the initial step, and during each step can also be
modified, if need be:</p>
<ul class="simple">
<li><p>_GetAttenContextDim: The dimensionality of the attention context vector.</p></li>
<li><p>_CreateAtten: Controls how the attention module is configured. Most
subclasses will not have to change this unless it changes how attention
works.</p></li>
<li><p>BaseZeroState: Returns initial state of RNNs, and attention.</p></li>
<li><p>_InitAttention: Initializes Tensors used by the attention module.</p></li>
<li><p>_GetInitialSeqStateTensorArrays: Get intitial tensor arrays for
ComputePredictionsDynamic.</p></li>
<li><p>_GetNewAttenProbs: Update atten probs for a timestep and return the
updated tensor array.</p></li>
</ul>
<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo">
<em class="property">class </em><code class="sig-name descname">TargetInfo</code><span class="sig-paren">(</span><em class="sig-param">id</em>, <em class="sig-param">label</em>, <em class="sig-param">weight</em>, <em class="sig-param">emb</em>, <em class="sig-param">padding</em>, <em class="sig-param">misc</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict">
<code class="sig-name descname">_asdict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new OrderedDict which maps field names to their values.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields">
<code class="sig-name descname">_fields</code><em class="property"> = ('id', 'label', 'weight', 'emb', 'padding', 'misc')</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make">
<em class="property">classmethod </em><code class="sig-name descname">_make</code><span class="sig-paren">(</span><em class="sig-param">iterable</em>, <em class="sig-param">new=&lt;built-in method __new__ of type object at 0xa39580&gt;</em>, <em class="sig-param">len=&lt;built-in function len&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new TargetInfo object from a sequence or iterable</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace">
<code class="sig-name descname">_replace</code><span class="sig-paren">(</span><em class="sig-param">**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new TargetInfo object replacing specified fields with new values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._source">
<code class="sig-name descname">_source</code><em class="property"> = &quot;from builtins import property as _property, tuple as _tuple\nfrom operator import itemgetter as _itemgetter\nfrom collections import OrderedDict\n\nclass TargetInfo(tuple):\n    'TargetInfo(id, label, weight, emb, padding, misc)'\n\n    __slots__ = ()\n\n    _fields = ('id', 'label', 'weight', 'emb', 'padding', 'misc')\n\n    def __new__(_cls, id, label, weight, emb, padding, misc):\n        'Create new instance of TargetInfo(id, label, weight, emb, padding, misc)'\n        return _tuple.__new__(_cls, (id, label, weight, emb, padding, misc))\n\n    &#64;classmethod\n    def _make(cls, iterable, new=tuple.__new__, len=len):\n        'Make a new TargetInfo object from a sequence or iterable'\n        result = new(cls, iterable)\n        if len(result) != 6:\n            raise TypeError('Expected 6 arguments, got %d' % len(result))\n        return result\n\n    def _replace(_self, **kwds):\n        'Return a new TargetInfo object replacing specified fields with new values'\n        result = _self._make(map(kwds.pop, ('id', 'label', 'weight', 'emb', 'padding', 'misc'), _self))\n        if kwds:\n            raise ValueError('Got unexpected field names: %r' % list(kwds))\n        return result\n\n    def __repr__(self):\n        'Return a nicely formatted representation string'\n        return self.__class__.__name__ + '(id=%r, label=%r, weight=%r, emb=%r, padding=%r, misc=%r)' % self\n\n    def _asdict(self):\n        'Return a new OrderedDict which maps field names to their values.'\n        return OrderedDict(zip(self._fields, self))\n\n    def __getnewargs__(self):\n        'Return self as a plain tuple.  Used by copy and pickle.'\n        return tuple(self)\n\n    id = _property(_itemgetter(0), doc='Alias for field number 0')\n\n    label = _property(_itemgetter(1), doc='Alias for field number 1')\n\n    weight = _property(_itemgetter(2), doc='Alias for field number 2')\n\n    emb = _property(_itemgetter(3), doc='Alias for field number 3')\n\n    padding = _property(_itemgetter(4), doc='Alias for field number 4')\n\n    misc = _property(_itemgetter(5), doc='Alias for field number 5')\n\n&quot;</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb">
<em class="property">property </em><code class="sig-name descname">emb</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id">
<em class="property">property </em><code class="sig-name descname">id</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label">
<em class="property">property </em><code class="sig-name descname">label</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc">
<em class="property">property </em><code class="sig-name descname">misc</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding">
<em class="property">property </em><code class="sig-name descname">padding</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight">
<em class="property">property </em><code class="sig-name descname">weight</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays">
<em class="property">class </em><code class="sig-name descname">SequenceOutTensorArrays</code><span class="sig-paren">(</span><em class="sig-param">rnn_outs</em>, <em class="sig-param">step_outs</em>, <em class="sig-param">atten_probs</em>, <em class="sig-param">logits</em>, <em class="sig-param">fusion</em>, <em class="sig-param">misc</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict">
<code class="sig-name descname">_asdict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new OrderedDict which maps field names to their values.</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields">
<code class="sig-name descname">_fields</code><em class="property"> = ('rnn_outs', 'step_outs', 'atten_probs', 'logits', 'fusion', 'misc')</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make">
<em class="property">classmethod </em><code class="sig-name descname">_make</code><span class="sig-paren">(</span><em class="sig-param">iterable</em>, <em class="sig-param">new=&lt;built-in method __new__ of type object at 0xa39580&gt;</em>, <em class="sig-param">len=&lt;built-in function len&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new SequenceOutTensorArrays object from a sequence or iterable</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace">
<code class="sig-name descname">_replace</code><span class="sig-paren">(</span><em class="sig-param">**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new SequenceOutTensorArrays object replacing specified fields with new values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._source">
<code class="sig-name descname">_source</code><em class="property"> = &quot;from builtins import property as _property, tuple as _tuple\nfrom operator import itemgetter as _itemgetter\nfrom collections import OrderedDict\n\nclass SequenceOutTensorArrays(tuple):\n    'SequenceOutTensorArrays(rnn_outs, step_outs, atten_probs, logits, fusion, misc)'\n\n    __slots__ = ()\n\n    _fields = ('rnn_outs', 'step_outs', 'atten_probs', 'logits', 'fusion', 'misc')\n\n    def __new__(_cls, rnn_outs, step_outs, atten_probs, logits, fusion, misc):\n        'Create new instance of SequenceOutTensorArrays(rnn_outs, step_outs, atten_probs, logits, fusion, misc)'\n        return _tuple.__new__(_cls, (rnn_outs, step_outs, atten_probs, logits, fusion, misc))\n\n    &#64;classmethod\n    def _make(cls, iterable, new=tuple.__new__, len=len):\n        'Make a new SequenceOutTensorArrays object from a sequence or iterable'\n        result = new(cls, iterable)\n        if len(result) != 6:\n            raise TypeError('Expected 6 arguments, got %d' % len(result))\n        return result\n\n    def _replace(_self, **kwds):\n        'Return a new SequenceOutTensorArrays object replacing specified fields with new values'\n        result = _self._make(map(kwds.pop, ('rnn_outs', 'step_outs', 'atten_probs', 'logits', 'fusion', 'misc'), _self))\n        if kwds:\n            raise ValueError('Got unexpected field names: %r' % list(kwds))\n        return result\n\n    def __repr__(self):\n        'Return a nicely formatted representation string'\n        return self.__class__.__name__ + '(rnn_outs=%r, step_outs=%r, atten_probs=%r, logits=%r, fusion=%r, misc=%r)' % self\n\n    def _asdict(self):\n        'Return a new OrderedDict which maps field names to their values.'\n        return OrderedDict(zip(self._fields, self))\n\n    def __getnewargs__(self):\n        'Return self as a plain tuple.  Used by copy and pickle.'\n        return tuple(self)\n\n    rnn_outs = _property(_itemgetter(0), doc='Alias for field number 0')\n\n    step_outs = _property(_itemgetter(1), doc='Alias for field number 1')\n\n    atten_probs = _property(_itemgetter(2), doc='Alias for field number 2')\n\n    logits = _property(_itemgetter(3), doc='Alias for field number 3')\n\n    fusion = _property(_itemgetter(4), doc='Alias for field number 4')\n\n    misc = _property(_itemgetter(5), doc='Alias for field number 5')\n\n&quot;</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._source" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs">
<em class="property">property </em><code class="sig-name descname">atten_probs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion">
<em class="property">property </em><code class="sig-name descname">fusion</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits">
<em class="property">property </em><code class="sig-name descname">logits</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc">
<em class="property">property </em><code class="sig-name descname">misc</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs">
<em class="property">property </em><code class="sig-name descname">rnn_outs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs">
<em class="property">property </em><code class="sig-name descname">step_outs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.UpdateTargetVocabSize">
<em class="property">classmethod </em><code class="sig-name descname">UpdateTargetVocabSize</code><span class="sig-paren">(</span><em class="sig-param">p</em>, <em class="sig-param">vocab_size</em>, <em class="sig-param">wpm_model=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.UpdateTargetVocabSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.UpdateTargetVocabSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the vocab size in the params.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>p</strong> – model params.</p></li>
<li><p><strong>vocab_size</strong> – size of the vocabulary.</p></li>
<li><p><strong>wpm_model</strong> – file name prefix pointing to a wordpiece model.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Model params updated with the vocab size and wpm model.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten">
<code class="sig-name descname">_CreateAtten</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._CreateAtten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim">
<code class="sig-name descname">_GetAttenContextDim</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenContextDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout">
<code class="sig-name descname">_ApplyDropout</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">x_in</em>, <em class="sig-param">deterministic=False</em>, <em class="sig-param">extra_seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ApplyDropout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention">
<code class="sig-name descname">_InitAttention</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitAttention"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Intializes attention and returns a NestedMap with those values.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState">
<code class="sig-name descname">BaseZeroState</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">bs</em>, <em class="sig-param">misc_zero_states</em>, <em class="sig-param">per_step_source_padding=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.BaseZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state of RNNs, and attention.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries">
<code class="sig-name descname">AddAdditionalDecoderSummaries</code><span class="sig-paren">(</span><em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">seq_out_tas</em>, <em class="sig-param">softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.AddAdditionalDecoderSummaries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Additional model-specific summaries which should be displayed.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState">
<code class="sig-name descname">DecoderStepZeroState</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">target_ids</em>, <em class="sig-param">bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.DecoderStepZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary">
<code class="sig-name descname">_AddDecoderActivationsSummary</code><span class="sig-paren">(</span><em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">atten_probs</em>, <em class="sig-param">rnn_outs</em>, <em class="sig-param">softmax_input</em>, <em class="sig-param">additional_atten_probs=None</em>, <em class="sig-param">target_alignments=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._AddDecoderActivationsSummary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds summary about decoder activations.</p>
<p>For each of the args, a TensorArray can also be a Tensor representing
the stacked array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – a NestedMap, usually input_batch.tgt.</p></li>
<li><p><strong>atten_probs</strong> – a TensorArray of max_target_length elements, each of shape
[batch, max_source_length].</p></li>
<li><p><strong>rnn_outs</strong> – a list of TensorArray, one for each RNN layer. Each
TensorArray has max_target_length elements, each of shape [batch,
rnn_output_dim].</p></li>
<li><p><strong>softmax_input</strong> – a Tensor of shape [batch, max_target_length, vocab_size].</p></li>
<li><p><strong>additional_atten_probs</strong> – an optional list of (name, TensorArray) to display
along with atten_probs.</p></li>
<li><p><strong>target_alignments</strong> – an optional Tensor of shape [batch, max_target_length]
where every value is an int32 in the range of [1, max_source_length],
representing number of source frames by which a target label should be
emitted.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A finalized figure.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics">
<code class="sig-name descname">_ComputeMetrics</code><span class="sig-paren">(</span><em class="sig-param">logits</em>, <em class="sig-param">target_labels</em>, <em class="sig-param">target_weights</em>, <em class="sig-param">target_probs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute loss and misc metrics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>logits</strong> – Tensor of shape [batch, time, num_classes].</p></li>
<li><p><strong>target_labels</strong> – Tensor of shape [batch, time].</p></li>
<li><p><strong>target_weights</strong> – Tensor of shape [batch, time].</p></li>
<li><p><strong>target_probs</strong> – Tensor of shape [batch, time, num_classes].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A (metrics, per_sequence_loss) pair.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder">
<code class="sig-name descname">InitDecoder</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">dec_bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.InitDecoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SampleTargetSequences">
<code class="sig-name descname">SampleTargetSequences</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">random_seed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.SampleTargetSequences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SampleTargetSequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs target sequence sampling.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this layer and its
children layers.</p></li>
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>random_seed</strong> – a scalar int32 tensor representing the random seed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>‘ids’: [batch, max_target_length] of int32, representing the target
sequence ids, not including target_sos_id, but maybe ending with
target_eos_id if target_eos_id is sampled.</p></li>
<li><p>’paddings’: [batch, max_target_length] of 0/1, where 1 represents
a padded timestep.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A NestedMap containing the following tensors</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback">
<code class="sig-name descname">_InitBeamSearchStateCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitBeamSearchStateCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback">
<code class="sig-name descname">_PreBeamSearchStepCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">step_ids</em>, <em class="sig-param">states</em>, <em class="sig-param">num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PreBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback">
<code class="sig-name descname">_PostBeamSearchStepCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">new_step_ids</em>, <em class="sig-param">states</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PostBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FProp">
<code class="sig-name descname">FProp</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes <code class="xref py py-obj docutils literal notranslate"><span class="pre">targets</span></code> given encoded source.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this layer and
its children layers.</p></li>
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – A NestedMap containing additional inputs to the decoder,
such as the targets being predicted.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A DecoderOutput namedtuple.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors">
<code class="sig-name descname">FPropWithPredictionsAndPerExampleTensors</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPerExampleLoss">
<code class="sig-name descname">FPropWithPerExampleLoss</code><span class="sig-paren">(</span><em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPerExampleLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPerExampleLoss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictions">
<code class="sig-name descname">FPropWithPredictions</code><span class="sig-paren">(</span><em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPredictions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns FProp() results together with predictions.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss">
<code class="sig-name descname">ComputeLoss</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">predictions</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputeLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeMetricsAndPerSequenceLoss">
<code class="sig-name descname">ComputeMetricsAndPerSequenceLoss</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">predictions</em>, <em class="sig-param">targets</em>, <em class="sig-param">targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputeMetricsAndPerSequenceLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeMetricsAndPerSequenceLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes loss metrics and per-sequence losses.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>predictions</strong> – A NestedMap containing logits (and possibly other fields).</p></li>
<li><p><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</p></li>
<li><p><strong>targets_per_batch_element</strong> – Number of target sequences per utterance.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(metrics, per_sequence_loss), where metrics is a dictionary containing
metrics for the xent loss and prediction accuracy. per_sequence_loss is a
(-log(p)) vector of size [bs].</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc">
<code class="sig-name descname">CreateTargetInfoMisc</code><span class="sig-paren">(</span><em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.CreateTargetInfoMisc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a NestedMap corresponding to the ‘misc’ field in TargetInfo.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions">
<code class="sig-name descname">ComputePredictions</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes logits.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights values of this layer and its
child layers.</p></li>
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</p></li>
<li><p><strong>targets_per_batch_element</strong> – (unused).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A NestedMap object containing logit tensors as values, each of shape
[target_batch, max_target_length, vocab_size]. One of the keys must be
‘logits’.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays">
<code class="sig-name descname">_GetInitialSeqStateTensorArrays</code><span class="sig-paren">(</span><em class="sig-param">max_seq_length</em>, <em class="sig-param">decoder_step_state_zero_fusion_flat</em>, <em class="sig-param">decoder_step_state_zero_misc_flat</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialSeqStateTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Get intitial tensor arrays for ComputePredictionsDynamic.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs">
<code class="sig-name descname">_GetNewAttenProbs</code><span class="sig-paren">(</span><em class="sig-param">seq_out_tas</em>, <em class="sig-param">time</em>, <em class="sig-param">decoder_step_state</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetNewAttenProbs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs" title="Permalink to this definition">¶</a></dt>
<dd><p>Update atten probs for a timestep and return the updated tensor array.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays">
<code class="sig-name descname">_UpdateSequenceOutTensorArrays</code><span class="sig-paren">(</span><em class="sig-param">decoder_step_state</em>, <em class="sig-param">time</em>, <em class="sig-param">step_outs</em>, <em class="sig-param">seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._UpdateSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Update SequenceOutTensorArrays at each time step.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays">
<code class="sig-name descname">_GetAttenProbsFromSequenceOutTensorArrays</code><span class="sig-paren">(</span><em class="sig-param">atten_probs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays">
<code class="sig-name descname">_GetPredictionFromSequenceOutTensorArrays</code><span class="sig-paren">(</span><em class="sig-param">seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo">
<code class="sig-name descname">_GetInitialTargetInfo</code><span class="sig-paren">(</span><em class="sig-param">targets</em>, <em class="sig-param">max_seq_length</em>, <em class="sig-param">target_embs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialTargetInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic">
<code class="sig-name descname">ComputePredictionsDynamic</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsDynamic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional">
<code class="sig-name descname">ComputePredictionsFunctional</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsFunctional"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits">
<code class="sig-name descname">_ComputeLogits</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeLogits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep">
<code class="sig-name descname">SingleDecodeStep</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">packed_src</em>, <em class="sig-param">cur_target_info</em>, <em class="sig-param">decoder_step_state</em>, <em class="sig-param">per_step_src_padding=None</em>, <em class="sig-param">use_deterministic_random=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.SingleDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes one ‘step’ of computation for the decoder.</p>
<p>Must be implemented by sub-classes. Residual connections must also be taken
care of in sub-classes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</p></li>
<li><p><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets
which represents information about the target at this step. It is up
to the various sub-classes to determine how to process the current
target.</p></li>
<li><p><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</p></li>
<li><p><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</p></li>
<li><p><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState">
<code class="sig-name descname">MiscZeroState</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">target_ids</em>, <em class="sig-param">bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.MiscZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state for other miscellaneous states, if any.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep">
<code class="sig-name descname">TargetsToBeFedAtCurrentDecodeStep</code><span class="sig-paren">(</span><em class="sig-param">time</em>, <em class="sig-param">theta</em>, <em class="sig-param">decoder_step_state</em>, <em class="sig-param">target_info_tas</em>, <em class="sig-param">seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate">
<code class="sig-name descname">PostStepDecoderStateUpdate</code><span class="sig-paren">(</span><em class="sig-param">decoder_step_state</em>, <em class="sig-param">logits=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.PostStepDecoderStateUpdate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Update decoder states and logits after SingleDecodeStep.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>decoder_step_state</strong> – A NestedMap object which encapsulates decoder states.</p></li>
<li><p><strong>logits</strong> – a tensor, predicted logits.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>decoder_step_state.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>ValueError</strong> – if scheduled sampling is used for functional unrolling or
    if logits is None for while loop based unrolling.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.tasks.asr.decoder.</code><code class="sig-name descname">AsrDecoder</code><span class="sig-paren">(</span><em class="sig-param">*args</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="lingvo.tasks.asr.decoder.AsrDecoderBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.tasks.asr.decoder.AsrDecoderBase</span></code></a></p>
<p>Step-by-step decoder with LM fusion.</p>
<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries">
<code class="sig-name descname">AddAdditionalDecoderSummaries</code><span class="sig-paren">(</span><em class="sig-param">encoder_outputs</em>, <em class="sig-param">targets</em>, <em class="sig-param">seq_out_tas</em>, <em class="sig-param">softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.AddAdditionalDecoderSummaries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Add summaries not covered by the default activations summaries.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</p></li>
<li><p><strong>targets</strong> – a NestedMap containing target info.</p></li>
<li><p><strong>seq_out_tas</strong> – a SequenceOutTensorArrays.</p></li>
<li><p><strong>softmax_input</strong> – a tensor of shape [batch, time, vocab_size].</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention">
<code class="sig-name descname">_ComputeAttention</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">rnn_out</em>, <em class="sig-param">packed_src</em>, <em class="sig-param">attention_state</em>, <em class="sig-param">per_step_src_padding=None</em>, <em class="sig-param">query_segment_id=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._ComputeAttention"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs attention and computes context vector.</p>
<p>Can be overridden by a child class if attention is computed differently.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights for the attention layers.
Expects a member named ‘atten’.</p></li>
<li><p><strong>rnn_out</strong> – A Tensor of shape [batch_size, query_dim]; output of the
first layer of decoder RNN, which is the query vector used for
attention.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap returned by self.atten.InitForSourcePacked.</p></li>
<li><p><strong>attention_state</strong> – The attention state computed at the previous timestep.
Varies with the type of attention, but is usually a Tensor or a
NestedMap of Tensors of shape [batch_size, &lt;state_dim&gt;].</p></li>
<li><p><strong>per_step_src_padding</strong> – Source sequence padding to apply at this step.</p></li>
<li><p><strong>query_segment_id</strong> – a tensor of shape [batch_size].</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p>The attention context vector: shaped [batch_size, context_dim].</p></li>
<li><p>The attention probability vector: shaped [batch_size, seq_len]</p></li>
<li><p>The attention state: A Tensor or a NestedMap of Tensors of shape
[batch_size, &lt;state_dim&gt;].</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>A 3-tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep">
<code class="sig-name descname">SingleDecodeStep</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">packed_src</em>, <em class="sig-param">cur_target_info</em>, <em class="sig-param">decoder_step_state</em>, <em class="sig-param">per_step_src_padding=None</em>, <em class="sig-param">use_deterministic_random=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.SingleDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode one step.</p>
<p>Note that the implementation of attention here follows the model in
<a class="reference external" href="https://arxiv.org/pdf/1609.08144.pdf">https://arxiv.org/pdf/1609.08144.pdf</a>, detailed more in
<a class="reference external" href="https://arxiv.org/pdf/1703.08581.pdf">https://arxiv.org/pdf/1703.08581.pdf</a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</p></li>
<li><p><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</p></li>
<li><p><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets
which represents information about the target at this step. It is up
to the various sub-classes to determine how to process the current
target.</p></li>
<li><p><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</p></li>
<li><p><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</p></li>
<li><p><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch">
<code class="sig-name descname">_GetNumHypsForBeamSearch</code><span class="sig-paren">(</span><em class="sig-param">source_encs</em>, <em class="sig-param">num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._GetNumHypsForBeamSearch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns number of hypothesis times batch_size.</p>
<p>This function can be overridden by a child class if the total number of
hyps are to be computed in a different way, e.g., when the format of inputs
change.
:param source_encs: A Tensor of [time, batch, dim] with source encodings.
:param num_hyps_per_beam: Int, the number of hypothesis per example in the beam.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A Tensor with value batch * num_hyps_per_beam.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch">
<code class="sig-name descname">_PostProcessAttenProbsForBeamSearch</code><span class="sig-paren">(</span><em class="sig-param">atten_probs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostProcessAttenProbsForBeamSearch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the attention probabilities after optional post processing.</p>
<p>This is a noop for the base class. But this function can be overridden
by a child class, e.g., when the format of probabilities change.
:param atten_probs: A Tensor of [batch, source_len] dimension with atten probs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A Tensor with processed atten_probs. The same as input in this case.</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback">
<code class="sig-name descname">_InitBeamSearchStateCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._InitBeamSearchStateCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback">
<code class="sig-name descname">_PreBeamSearchStepCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">step_ids</em>, <em class="sig-param">states</em>, <em class="sig-param">num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PreBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback">
<code class="sig-name descname">_PostBeamSearchStepCallback</code><span class="sig-paren">(</span><em class="sig-param">theta</em>, <em class="sig-param">encoder_outputs</em>, <em class="sig-param">new_step_ids</em>, <em class="sig-param">states</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.tasks.asr.decoder_utils.html" class="btn btn-neutral float-right" title="lingvo.tasks.asr.decoder_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.tasks.asr.contextualizer_base.html" class="btn btn-neutral float-left" title="lingvo.tasks.asr.contextualizer_base module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>