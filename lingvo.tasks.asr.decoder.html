

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.tasks.asr.decoder module &mdash; Lingvo  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.tasks.asr.decoder_utils module" href="lingvo.tasks.asr.decoder_utils.html" />
    <link rel="prev" title="lingvo.tasks.asr.contextualizer_base module" href="lingvo.tasks.asr.contextualizer_base.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.tasks.html#subpackages">Subpackages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.html">lingvo.tasks package</a> &raquo;</li>
        
          <li><a href="lingvo.tasks.asr.html">lingvo.tasks.asr package</a> &raquo;</li>
        
      <li>lingvo.tasks.asr.decoder module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.tasks.asr.decoder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.tasks.asr.decoder">
<span id="lingvo-tasks-asr-decoder-module"></span><h1>lingvo.tasks.asr.decoder module<a class="headerlink" href="#module-lingvo.tasks.asr.decoder" title="Permalink to this headline">¶</a></h1>
<p>Decoders for the speech model.</p>
<dl class="function">
<dt id="lingvo.tasks.asr.decoder._ToTensorArray">
<code class="descclassname">lingvo.tasks.asr.decoder.</code><code class="descname">_ToTensorArray</code><span class="sig-paren">(</span><em>name</em>, <em>v</em>, <em>max_seq_length</em>, <em>clear_after_read=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_ToTensorArray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._ToTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create TensorArray from v, of size max_seq_length.</p>
</dd></dl>

<dl class="function">
<dt id="lingvo.tasks.asr.decoder._NewTensorArray">
<code class="descclassname">lingvo.tasks.asr.decoder.</code><code class="descname">_NewTensorArray</code><span class="sig-paren">(</span><em>name</em>, <em>max_seq_length</em>, <em>dtype=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#_NewTensorArray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder._NewTensorArray" title="Permalink to this definition">¶</a></dt>
<dd><p>Create empty TensorArray which can store max_seq_length elements.</p>
</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase">
<em class="property">class </em><code class="descclassname">lingvo.tasks.asr.decoder.</code><code class="descname">AsrDecoderBase</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_decoder.html#lingvo.core.base_decoder.BaseBeamSearchDecoder" title="lingvo.core.base_decoder.BaseBeamSearchDecoder"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_decoder.BaseBeamSearchDecoder</span></code></a></p>
<p>Base class for RNN-with-attention speech decoders.</p>
<p>The decoder takes encoder_outputs, a NestedMap generated by the encoder, as
input. The NestedMap is expected to contain the following fields:</p>
<blockquote>
<div><ul class="simple">
<li>‘encoded’: encoded features</li>
<li>‘padding’: padding for encoded features</li>
</ul>
</div></blockquote>
<p>The decoder operates in a ‘step-by-step’ fashion. The model encapsulates all
information which should persist from one step to the next in the
DecoderStepState NestedMap, which provides a ‘misc_states’ NestedMap which can
store arbitrary information required by the specific decoder sub-class.</p>
<p>A ‘step’ in training consists of the following sequence of steps which compute
the outputs from the decoder given the current input target (and the state of
the model after making the previous predictions):</p>
<ol class="arabic">
<li><p class="first">Compute the input target at the current time step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cur_target_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TargetsToBeFedAtCurrentDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Update state and compute outputs by running SingleDecodeStep:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">step_outs</span><span class="p">,</span> <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SingleDecodeStep</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Update state based on the logits computed at this step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PostStepDecoderStateUpdate</span><span class="p">(</span><span class="n">old_state</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Display summaries based on the accumulated information across all steps:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">AddAdditionalDecoderSummaries</span><span class="p">(</span><span class="n">seq_out_tas</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Sub-classes can customize behavior by implementing the following functions,
which will modify the behavior of the decoder:</p>
<ul class="simple">
<li>GetTargetLabelSequencesWithBeamSearch: Needed for EMBR training.</li>
<li>_InitBeamSearchStateCallback: Needed by beam search decoder.</li>
<li>_PreBeamSearchStepCallback</li>
<li>_PostBeamSearchStepCallback</li>
<li>MiscZeroState: NestedMap which represents the initial state for the
‘misc_states’ in the DecoderStepState. The default implementation returns
an empty NestedMap.</li>
<li>SingleDecodeStep: This corresponds to the computation which happens in each
step of the model. The function should return the outputs of the decoder
as well as the updated state.</li>
<li>PostStepDecoderStateUpdate: A function which updates the DecoderStepState
after the output logits from the decoder have been computed. By default,
this returns the DecoderStepState unchanged.</li>
<li>TargetsToBeFedAtCurrentDecodeStep: Returns a TargetInfo namedtuple, which
represents information about the targets which should be input at the
current step, as well as the output label which should be predicted.
The default implementation uses the values in the batched ‘targets’
provided by the InputGenerator.</li>
<li>AddAdditionalDecoderSummaries: A function which can be used to add any
decoder specific information as part of the summaries displayed during
training. By default this is a no-op.</li>
<li>CreateTargetInfoMisc: A function which can be used to store arbitrary
information as required by a sub-classes in the target info arrays used
to determine the current label at each step during training. By default,
this creates an empty NestedMap.</li>
</ul>
<p>A few other functions that control how the decoder initializes and computes
attention during the initial step, and during each step can also be
modified, if need be:</p>
<ul class="simple">
<li>_GetAttenContextDim: The dimensionality of the attention context vector.</li>
<li>_CreateAtten: Controls how the attention module is configured. Most
subclasses will not have to change this unless it changes how attention
works.</li>
<li>BaseZeroState: Returns initial state of RNNs, and attention.</li>
<li>_InitAttention: Initializes Tensors used by the attention module.</li>
<li>_GetInitialSeqStateTensorArrays: Get intitial tensor arrays for
ComputePredictionsDynamic.</li>
<li>_GetNewAttenProbs: Update atten probs for a timestep and return the
updated tensor array.</li>
</ul>
<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo">
<em class="property">class </em><code class="descname">TargetInfo</code><span class="sig-paren">(</span><em>id</em>, <em>label</em>, <em>weight</em>, <em>emb</em>, <em>padding</em>, <em>misc</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict">
<code class="descname">_asdict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new OrderedDict which maps field names to their values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields">
<code class="descname">_fields</code><em class="property"> = ('id', 'label', 'weight', 'emb', 'padding', 'misc')</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make">
<em class="property">classmethod </em><code class="descname">_make</code><span class="sig-paren">(</span><em>iterable</em>, <em>new=&lt;built-in method __new__ of type object at 0x8f9920&gt;</em>, <em>len=&lt;built-in function len&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new TargetInfo object from a sequence or iterable</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace">
<code class="descname">_replace</code><span class="sig-paren">(</span><em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new TargetInfo object replacing specified fields with new values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb">
<code class="descname">emb</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.emb" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id">
<code class="descname">id</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.id" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label">
<code class="descname">label</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.label" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc">
<code class="descname">misc</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding">
<code class="descname">padding</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.padding" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight">
<code class="descname">weight</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetInfo.weight" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays">
<em class="property">class </em><code class="descname">SequenceOutTensorArrays</code><span class="sig-paren">(</span><em>rnn_outs</em>, <em>step_outs</em>, <em>atten_probs</em>, <em>logits</em>, <em>fusion</em>, <em>misc</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></p>
<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict">
<code class="descname">_asdict</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._asdict" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new OrderedDict which maps field names to their values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields">
<code class="descname">_fields</code><em class="property"> = ('rnn_outs', 'step_outs', 'atten_probs', 'logits', 'fusion', 'misc')</em><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._fields" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="classmethod">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make">
<em class="property">classmethod </em><code class="descname">_make</code><span class="sig-paren">(</span><em>iterable</em>, <em>new=&lt;built-in method __new__ of type object at 0x8f9920&gt;</em>, <em>len=&lt;built-in function len&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._make" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a new SequenceOutTensorArrays object from a sequence or iterable</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace">
<code class="descname">_replace</code><span class="sig-paren">(</span><em>**kwds</em><span class="sig-paren">)</span><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays._replace" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a new SequenceOutTensorArrays object replacing specified fields with new values</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs">
<code class="descname">atten_probs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.atten_probs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion">
<code class="descname">fusion</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.fusion" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits">
<code class="descname">logits</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.logits" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc">
<code class="descname">misc</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.misc" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs">
<code class="descname">rnn_outs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.rnn_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs">
<code class="descname">step_outs</code><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SequenceOutTensorArrays.step_outs" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

</dd></dl>

<dl class="classmethod">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten">
<code class="descname">_CreateAtten</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._CreateAtten"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._CreateAtten" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim">
<code class="descname">_GetAttenContextDim</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenContextDim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenContextDim" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout">
<code class="descname">_ApplyDropout</code><span class="sig-paren">(</span><em>theta</em>, <em>x_in</em>, <em>deterministic=False</em>, <em>extra_seed=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ApplyDropout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ApplyDropout" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention">
<code class="descname">_InitAttention</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitAttention"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Intializes attention and returns a NestedMap with those values.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState">
<code class="descname">BaseZeroState</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>bs</em>, <em>misc_zero_states</em>, <em>per_step_source_padding=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.BaseZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.BaseZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state of RNNs, and attention.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries">
<code class="descname">AddAdditionalDecoderSummaries</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>targets</em>, <em>seq_out_tas</em>, <em>softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.AddAdditionalDecoderSummaries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Additional model-specific summaries which should be displayed.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState">
<code class="descname">DecoderStepZeroState</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>target_ids</em>, <em>bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.DecoderStepZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.DecoderStepZeroState" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary">
<code class="descname">_AddDecoderActivationsSummary</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>targets</em>, <em>atten_probs</em>, <em>rnn_outs</em>, <em>softmax_input</em>, <em>additional_atten_probs=None</em>, <em>target_alignments=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._AddDecoderActivationsSummary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._AddDecoderActivationsSummary" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds summary about decoder activations.</p>
<p>For each of the args, a TensorArray can also be a Tensor representing
the stacked array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>targets</strong> – a NestedMap, usually input_batch.tgt.</li>
<li><strong>atten_probs</strong> – a TensorArray of max_target_length elements, each of shape
[batch, max_source_length].</li>
<li><strong>rnn_outs</strong> – a list of TensorArray, one for each RNN layer. Each
TensorArray has max_target_length elements, each of shape [batch,
rnn_output_dim].</li>
<li><strong>softmax_input</strong> – a Tensor of shape [batch, max_target_length, vocab_size].</li>
<li><strong>additional_atten_probs</strong> – an optional list of (name, TensorArray) to display
along with atten_probs.</li>
<li><strong>target_alignments</strong> – an optional Tensor of shape [batch, max_target_length]
where every value is an int32 in the range of [1, max_source_length],
representing number of source frames by which a target label should be
emitted.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A finalized figure.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics">
<code class="descname">_ComputeMetrics</code><span class="sig-paren">(</span><em>logits</em>, <em>target_labels</em>, <em>target_weights</em>, <em>target_probs=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeMetrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeMetrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute loss and misc metrics.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>logits</strong> – Tensor of shape [batch, time, num_classes].</li>
<li><strong>target_labels</strong> – Tensor of shape [batch, time].</li>
<li><strong>target_weights</strong> – Tensor of shape [batch, time].</li>
<li><strong>target_probs</strong> – Tensor of shape [batch, time, num_classes].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A (metrics, per_sequence_loss) pair.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder">
<code class="descname">InitDecoder</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>dec_bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.InitDecoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.InitDecoder" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.BeamSearchDecode">
<code class="descname">BeamSearchDecode</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>num_hyps_per_beam_override=0</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.BeamSearchDecode"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.BeamSearchDecode" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs beam-search based decoding.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>num_hyps_per_beam_override</strong> – If set to a value &lt;= 0, this parameter is
ignored. If set to a value &gt; 0, then this value will be used to override
p.num_hyps_per_beam.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">BeamSearchDecodeOutput, a namedtuple containing the decode results</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SampleTargetSequences">
<code class="descname">SampleTargetSequences</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>random_seed</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.SampleTargetSequences"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SampleTargetSequences" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs target sequence sampling.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights’ values of this layer and its
children layers.</li>
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>random_seed</strong> – a scalar int32 tensor representing the random seed.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><ul class="simple">
<li>‘ids’: [batch, max_target_length] of int32, representing the target
sequence ids, not including target_sos_id, but maybe ending with
target_eos_id if target_eos_id is sampled.</li>
<li>’paddings’: [batch, max_target_length] of 0/1, where 1 represents
a padded timestep.</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">A NestedMap containing the following tensors</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback">
<code class="descname">_InitBeamSearchStateCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._InitBeamSearchStateCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback">
<code class="descname">_PreBeamSearchStepCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>step_ids</em>, <em>states</em>, <em>num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PreBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback">
<code class="descname">_PostBeamSearchStepCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>new_step_ids</em>, <em>states</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._PostBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FProp">
<code class="descname">FProp</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FProp"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FProp" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes <code class="xref py py-obj docutils literal notranslate"><span class="pre">targets</span></code> given encoded source.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> object containing weights’ values of this layer and
its children layers.</li>
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>targets</strong> – A dict of string to tensors representing the targets one try to
predict.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A DecoderOutput namedtuple.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors">
<code class="descname">FPropWithPredictionsAndPerExampleTensors</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>targets</em>, <em>targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictionsAndPerExampleTensors" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPerExampleLoss">
<code class="descname">FPropWithPerExampleLoss</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>targets</em>, <em>targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPerExampleLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPerExampleLoss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictions">
<code class="descname">FPropWithPredictions</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.FPropWithPredictions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.FPropWithPredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns FProp() results together with predictions.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss">
<code class="descname">ComputeLoss</code><span class="sig-paren">(</span><em>theta</em>, <em>predictions</em>, <em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputeLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeLoss" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeMetricsAndPerSequenceLoss">
<code class="descname">ComputeMetricsAndPerSequenceLoss</code><span class="sig-paren">(</span><em>theta</em>, <em>predictions</em>, <em>targets</em>, <em>targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputeMetricsAndPerSequenceLoss"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputeMetricsAndPerSequenceLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes loss metrics and per-sequence losses.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</li>
<li><strong>predictions</strong> – A NestedMap containing logits (and possibly other fields).</li>
<li><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</li>
<li><strong>targets_per_batch_element</strong> – Number of target sequences per utterance.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">(metrics, per_sequence_loss), where metrics is a dictionary containing
metrics for the xent loss and prediction accuracy. per_sequence_loss is a
(-log(p)) vector of size [bs].</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc">
<code class="descname">CreateTargetInfoMisc</code><span class="sig-paren">(</span><em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.CreateTargetInfoMisc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.CreateTargetInfoMisc" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a NestedMap corresponding to the ‘misc’ field in TargetInfo.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions">
<code class="descname">ComputePredictions</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>targets</em>, <em>targets_per_batch_element=1</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictions" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes logits.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights values of this layer and its
child layers.</li>
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>targets</strong> – A dict of string to tensors representing the targets one is
trying to predict. Each tensor in targets is of shape [batch, time].</li>
<li><strong>targets_per_batch_element</strong> – (unused).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A NestedMap object containing logit tensors as values, each of shape
[target_batch, max_target_length, vocab_size]. One of the keys must be
‘logits’.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays">
<code class="descname">_GetInitialSeqStateTensorArrays</code><span class="sig-paren">(</span><em>max_seq_length</em>, <em>decoder_step_state_zero_fusion_flat</em>, <em>decoder_step_state_zero_misc_flat</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialSeqStateTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialSeqStateTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Get intitial tensor arrays for ComputePredictionsDynamic.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs">
<code class="descname">_GetNewAttenProbs</code><span class="sig-paren">(</span><em>seq_out_tas</em>, <em>time</em>, <em>decoder_step_state</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetNewAttenProbs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetNewAttenProbs" title="Permalink to this definition">¶</a></dt>
<dd><p>Update atten probs for a timestep and return the updated tensor array.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays">
<code class="descname">_UpdateSequenceOutTensorArrays</code><span class="sig-paren">(</span><em>decoder_step_state</em>, <em>time</em>, <em>step_outs</em>, <em>seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._UpdateSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._UpdateSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd><p>Update SequenceOutTensorArrays at each time step.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays">
<code class="descname">_GetAttenProbsFromSequenceOutTensorArrays</code><span class="sig-paren">(</span><em>atten_probs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetAttenProbsFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays">
<code class="descname">_GetPredictionFromSequenceOutTensorArrays</code><span class="sig-paren">(</span><em>seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetPredictionFromSequenceOutTensorArrays" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo">
<code class="descname">_GetInitialTargetInfo</code><span class="sig-paren">(</span><em>targets</em>, <em>max_seq_length</em>, <em>target_embs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._GetInitialTargetInfo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._GetInitialTargetInfo" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic">
<code class="descname">ComputePredictionsDynamic</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsDynamic"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsDynamic" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional">
<code class="descname">ComputePredictionsFunctional</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>targets</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.ComputePredictionsFunctional"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.ComputePredictionsFunctional" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits">
<code class="descname">_ComputeLogits</code><span class="sig-paren">(</span><em>theta</em>, <em>softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase._ComputeLogits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase._ComputeLogits" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep">
<code class="descname">SingleDecodeStep</code><span class="sig-paren">(</span><em>theta</em>, <em>packed_src</em>, <em>cur_target_info</em>, <em>decoder_step_state</em>, <em>per_step_src_padding=None</em>, <em>use_deterministic_random=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.SingleDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes one ‘step’ of computation for the decoder.</p>
<p>Must be implemented by sub-classes. Residual connections must also be taken
care of in sub-classes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</li>
<li><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</li>
<li><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets
which represents information about the target at this step. It is up
to the various sub-classes to determine how to process the current
target.</li>
<li><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</li>
<li><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</li>
<li><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState">
<code class="descname">MiscZeroState</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>target_ids</em>, <em>bs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.MiscZeroState"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.MiscZeroState" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns initial state for other miscellaneous states, if any.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep">
<code class="descname">TargetsToBeFedAtCurrentDecodeStep</code><span class="sig-paren">(</span><em>time</em>, <em>theta</em>, <em>decoder_step_state</em>, <em>target_info_tas</em>, <em>seq_out_tas</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.TargetsToBeFedAtCurrentDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate">
<code class="descname">PostStepDecoderStateUpdate</code><span class="sig-paren">(</span><em>decoder_step_state</em>, <em>logits=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoderBase.PostStepDecoderStateUpdate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoderBase.PostStepDecoderStateUpdate" title="Permalink to this definition">¶</a></dt>
<dd><p>Update decoder states and logits after SingleDecodeStep.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>decoder_step_state</strong> – A NestedMap object which encapsulates decoder states.</li>
<li><strong>logits</strong> – a tensor, predicted logits.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">decoder_step_state.</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code> – if scheduled sampling is used for functional unrolling or
if logits is None for while loop based unrolling.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder">
<em class="property">class </em><code class="descclassname">lingvo.tasks.asr.decoder.</code><code class="descname">AsrDecoder</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.tasks.asr.decoder.AsrDecoderBase" title="lingvo.tasks.asr.decoder.AsrDecoderBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.tasks.asr.decoder.AsrDecoderBase</span></code></a></p>
<p>Step-by-step decoder with LM fusion.</p>
<dl class="classmethod">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.Params">
<em class="property">classmethod </em><code class="descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the layer params.</p>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries">
<code class="descname">AddAdditionalDecoderSummaries</code><span class="sig-paren">(</span><em>encoder_outputs</em>, <em>targets</em>, <em>seq_out_tas</em>, <em>softmax_input</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.AddAdditionalDecoderSummaries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.AddAdditionalDecoderSummaries" title="Permalink to this definition">¶</a></dt>
<dd><p>Add summaries not covered by the default activations summaries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>encoder_outputs</strong> – a NestedMap computed by encoder.</li>
<li><strong>targets</strong> – a NestedMap containing target info.</li>
<li><strong>seq_out_tas</strong> – a SequenceOutTensorArrays.</li>
<li><strong>softmax_input</strong> – a tensor of shape [batch, time, vocab_size].</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention">
<code class="descname">_ComputeAttention</code><span class="sig-paren">(</span><em>theta</em>, <em>rnn_out</em>, <em>packed_src</em>, <em>attention_state</em>, <em>per_step_src_padding=None</em>, <em>query_segment_id=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._ComputeAttention"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._ComputeAttention" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs attention and computes context vector.</p>
<p>Can be overridden by a child class if attention is computed differently.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights for the attention layers.
Expects a member named ‘atten’.</li>
<li><strong>rnn_out</strong> – A Tensor of shape [batch_size, query_dim]; output of the
first layer of decoder RNN, which is the query vector used for
attention.</li>
<li><strong>packed_src</strong> – A NestedMap returned by self.atten.InitForSourcePacked.</li>
<li><strong>attention_state</strong> – The attention state computed at the previous timestep.
Varies with the type of attention, but is usually a Tensor or a
NestedMap of Tensors of shape [batch_size, &lt;state_dim&gt;].</li>
<li><strong>per_step_src_padding</strong> – Source sequence padding to apply at this step.</li>
<li><strong>query_segment_id</strong> – a tensor of shape [batch_size].</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><ul class="simple">
<li>The attention context vector: shaped [batch_size, context_dim].</li>
<li>The attention probability vector: shaped [batch_size, seq_len]</li>
<li>The attention state: A Tensor or a NestedMap of Tensors of shape
[batch_size, &lt;state_dim&gt;].</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">A 3-tuple</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep">
<code class="descname">SingleDecodeStep</code><span class="sig-paren">(</span><em>theta</em>, <em>packed_src</em>, <em>cur_target_info</em>, <em>decoder_step_state</em>, <em>per_step_src_padding=None</em>, <em>use_deterministic_random=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder.SingleDecodeStep"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder.SingleDecodeStep" title="Permalink to this definition">¶</a></dt>
<dd><p>Decode one step.</p>
<p>Note that the implementation of attention here follows the model in
<a class="reference external" href="https://arxiv.org/pdf/1609.08144.pdf">https://arxiv.org/pdf/1609.08144.pdf</a>, detailed more in
<a class="reference external" href="https://arxiv.org/pdf/1703.08581.pdf">https://arxiv.org/pdf/1703.08581.pdf</a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>theta</strong> – A NestedMap object containing weights’ values of this
layer and its children layers.</li>
<li><strong>packed_src</strong> – A NestedMap to represent the packed source tensors generated
by the attention model.</li>
<li><strong>cur_target_info</strong> – TargetInfo namedtuple, which represents the targets
which represents information about the target at this step. It is up
to the various sub-classes to determine how to process the current
target.</li>
<li><strong>decoder_step_state</strong> – DecoderStepState which encapsulates the state of the
decoder before computing outputs at the current step.</li>
<li><strong>per_step_src_padding</strong> – Optional padding to be applied to the source_encs
which overrides the default padding in source_paddings. Used, for
example, by the Neural Transducer (NT) decoder.</li>
<li><strong>use_deterministic_random</strong> – whether to use deterministic random numbers when
needed. Must be set to True if called from functional recurrent.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">A tuple (step_out, new_decoder_state) which represent the outputs of the
decoder (usually logits), and the new decoder state after processing the
current step.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch">
<code class="descname">_GetNumHypsForBeamSearch</code><span class="sig-paren">(</span><em>source_encs</em>, <em>num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._GetNumHypsForBeamSearch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._GetNumHypsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns number of hypothesis times batch_size.</p>
<p>This function can be overridden by a child class if the total number of
hyps are to be computed in a different way, e.g., when the format of inputs
change.
:param source_encs: A Tensor of [dim, batch] dimension with source encodings.
:param num_hyps_per_beam: Int, the number of hypothesis per example in the beam.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A Tensor with value batch * num_hyps_per_beam.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch">
<code class="descname">_PostProcessAttenProbsForBeamSearch</code><span class="sig-paren">(</span><em>atten_probs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostProcessAttenProbsForBeamSearch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostProcessAttenProbsForBeamSearch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the attention probabilities after optional post processing.</p>
<p>This is a noop for the base class. But this function can be overridden
by a child class, e.g., when the format of probabilities change.
:param atten_probs: A Tensor of [batch, source_len] dimension with atten probs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A Tensor with processed atten_probs. The same as input in this case.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback">
<code class="descname">_InitBeamSearchStateCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._InitBeamSearchStateCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._InitBeamSearchStateCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback">
<code class="descname">_PreBeamSearchStepCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>step_ids</em>, <em>states</em>, <em>num_hyps_per_beam</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PreBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PreBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback">
<code class="descname">_PostBeamSearchStepCallback</code><span class="sig-paren">(</span><em>theta</em>, <em>encoder_outputs</em>, <em>new_step_ids</em>, <em>states</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/tasks/asr/decoder.html#AsrDecoder._PostBeamSearchStepCallback"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.tasks.asr.decoder.AsrDecoder._PostBeamSearchStepCallback" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.tasks.asr.decoder_utils.html" class="btn btn-neutral float-right" title="lingvo.tasks.asr.decoder_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.tasks.asr.contextualizer_base.html" class="btn btn-neutral float-left" title="lingvo.tasks.asr.contextualizer_base module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>