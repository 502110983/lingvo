

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>lingvo.core.base_input_generator module &mdash; Lingvo  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="lingvo.core.base_layer module" href="lingvo.core.base_layer.html" />
    <link rel="prev" title="lingvo.core.base_decoder module" href="lingvo.core.base_decoder.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Lingvo
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="lingvo.html">lingvo package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lingvo.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="lingvo.core.html">lingvo.core package</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="lingvo.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="lingvo.core.html#submodules">Submodules</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tasks.html">lingvo.tasks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lingvo.tools.html">lingvo.tools package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lingvo.html#submodules">Submodules</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Lingvo</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="lingvo.html">lingvo package</a> &raquo;</li>
        
          <li><a href="lingvo.core.html">lingvo.core package</a> &raquo;</li>
        
      <li>lingvo.core.base_input_generator module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/lingvo.core.base_input_generator.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-lingvo.core.base_input_generator">
<span id="lingvo-core-base-input-generator-module"></span><h1>lingvo.core.base_input_generator module<a class="headerlink" href="#module-lingvo.core.base_input_generator" title="Permalink to this headline">¶</a></h1>
<p>Input generators.</p>
<p>There are three types of batch sizes:</p>
<ul class="simple">
<li><p>Device split batch size: Defined by Params() and is the batch size
on each device/TPU core. BaseInputGenerator.params.batch_size and
BaseSequenceInputGenerator.params.bucket_batch_limit specify per-split batch
size.</p></li>
<li><p>GlobalBatchSize: number of examples in a global batch.</p></li>
<li><p>InfeedBatchSize: global_batch_size // num_infeed_hosts, where
num_infeed_hosts is cluster.num_tpu_hosts if using per-host infeed with TPU,
otherwise num_infeed_hosts is 1.</p></li>
</ul>
<p>TODO(rpang): Deal with on packed_inputs.</p>
<dl class="py class">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_input_generator.</code><code class="sig-name descname">BaseInputGenerator</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="lingvo.core.base_layer.html#lingvo.core.base_layer.BaseLayer" title="lingvo.core.base_layer.BaseLayer"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_layer.BaseLayer</span></code></a></p>
<p>The abstract base input generator.</p>
<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults params for input generators.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.CommonInputOpArgs">
<code class="sig-name descname">CommonInputOpArgs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.CommonInputOpArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.CommonInputOpArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Common input params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.GetBpropVariableFilters">
<code class="sig-name descname">GetBpropVariableFilters</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.GetBpropVariableFilters"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.GetBpropVariableFilters" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.GetInputSourceOneHot">
<code class="sig-name descname">GetInputSourceOneHot</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.GetInputSourceOneHot"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.GetInputSourceOneHot" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current bprop type of the input generator batch.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.GlobalBatchSize">
<code class="sig-name descname">GlobalBatchSize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.GlobalBatchSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.GlobalBatchSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the total batch size (for stats), int or dynamic int tensor.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.InfeedBatchSize">
<code class="sig-name descname">InfeedBatchSize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.InfeedBatchSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.InfeedBatchSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the batch size of the input batch: int or dynamic int tensor.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator._InputBatch">
<code class="sig-name descname">_InputBatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator._InputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator._InputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>The current input batch, not preprocessed.</p>
<p>This is meant to be overridden by subclasses, but not called directly.
Callers should use <a class="reference internal" href="#lingvo.core.base_input_generator.BaseInputGenerator.GetPreprocessedInputBatch" title="lingvo.core.base_input_generator.BaseInputGenerator.GetPreprocessedInputBatch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">GetPreprocessedInputBatch()</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of input tensors. Each tensor’s dim-0 must be the same
and denotes the batch dimension.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator._PreprocessInputBatch">
<code class="sig-name descname">_PreprocessInputBatch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">batch</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator._PreprocessInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator._PreprocessInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Preprocesses input batch from _InputBatch.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>batch</strong> – A NestedMap containing input tensors in the format returned by
_InputBatch.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A NestedMap containing preprocessed inputs to feed to the model.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.GetPreprocessedInputBatch">
<code class="sig-name descname">GetPreprocessedInputBatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.GetPreprocessedInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.GetPreprocessedInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a NestedMap containing a preprocessed batch of inputs.</p>
<p>These are the actual inputs fed to the model.</p>
<p>Subclasses generally should not override this function directly. Instead,
override _InputBatch and maybe _PreprocessInputBatch.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.CreateTpuFeeds">
<code class="sig-name descname">CreateTpuFeeds</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.CreateTpuFeeds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.CreateTpuFeeds" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the TPU infeed queue from preprocessed batch.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.tpu_infeed_op">
<em class="property">property </em><code class="sig-name descname">tpu_infeed_op</code><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.tpu_infeed_op" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGenerator.SplitInputBatch">
<code class="sig-name descname">SplitInputBatch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_splits</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGenerator.SplitInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGenerator.SplitInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits the current InputBatch into num_splits ways.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>num_splits</strong> – The number of splits.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a>. Each <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> represents the input
tensors in one split.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_input_generator.</code><code class="sig-name descname">BaseInputGeneratorFromFiles</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_input_generator.BaseInputGenerator" title="lingvo.core.base_input_generator.BaseInputGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_input_generator.BaseInputGenerator</span></code></a></p>
<p>Base class for input generators that reads from files.</p>
<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults params for input generators.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles.CommonInputOpArgs">
<code class="sig-name descname">CommonInputOpArgs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles.CommonInputOpArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles.CommonInputOpArgs" title="Permalink to this definition">¶</a></dt>
<dd><p>Common input params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._InputOpBucketingArgs">
<code class="sig-name descname">_InputOpBucketingArgs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles._InputOpBucketingArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._InputOpBucketingArgs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._DataSourceFromFilePattern">
<code class="sig-name descname">_DataSourceFromFilePattern</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">file_pattern</span></em>, <em class="sig-param"><span class="n">input_source_weights</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles._DataSourceFromFilePattern"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._DataSourceFromFilePattern" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and return input batch from a string file_pattern.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>file_pattern</strong> – A string file pattern.</p></li>
<li><p><strong>input_source_weights</strong> – A list of float input source weights to control
input example mix in the batch. The records will be sampled from inputs
proportionally to these weights. Defaults to None which should be
treated as an empty list.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple of tf.Tensors where the tensors which contain the input data and
have major dimension same as size of input batch.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._BuildDataSourceWithMetadata">
<code class="sig-name descname">_BuildDataSourceWithMetadata</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles._BuildDataSourceWithMetadata"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._BuildDataSourceWithMetadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and return input batch from <code class="xref py py-obj docutils literal notranslate"><span class="pre">p.file_pattern</span></code>.</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">p.file_pattern</span></code> may be a string file_pattern or a
list of (file_pattern, weight, [bprop_variable_filter]) tuples.
bprop_variable_filter is optional. When bprop_variable_filter is used,
batches will always contain the examples from the same source. Otherwise,
examples from different sources may be mixed together.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> containing</p>
<ul class="simple">
<li><p>data: a tuple of tf.Tensor or <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of
tf.Tensor same as <code class="xref py py-obj docutils literal notranslate"><span class="pre">self._DataSourceFromFilePattern()</span></code></p></li>
<li><p>source_selected: a tensor of size [batch_size, number of data sources]
or None.</p></li>
<li><p>selected_bprop: a tensor of size [number of data sources] or None.</p></li>
<li><p>bprop_variable_filters: a list of bprop_variable filters for each source
or None.</p></li>
</ul>
</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – If file_datasource is not set</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._BuildDataSource">
<code class="sig-name descname">_BuildDataSource</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseInputGeneratorFromFiles._BuildDataSource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles._BuildDataSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Read and return input batch from <code class="xref py py-obj docutils literal notranslate"><span class="pre">p.file_pattern</span></code>.</p>
<p>Same as _BuildDataSourceWithMetadata but does not return any metadata.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A tuple of tf.Tensor or <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of tf.Tensor same as
<code class="xref py py-obj docutils literal notranslate"><span class="pre">self._DataSourceFromFilePattern()</span></code>.</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – If unknown token type.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_input_generator.</code><code class="sig-name descname">BaseSequenceInputGenerator</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_input_generator.BaseInputGeneratorFromFiles" title="lingvo.core.base_input_generator.BaseInputGeneratorFromFiles"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_input_generator.BaseInputGeneratorFromFiles</span></code></a></p>
<p>The basic sequence input generator.</p>
<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults params for sequence input generators.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.infeed_bucket_batch_limit">
<em class="property">property </em><code class="sig-name descname">infeed_bucket_batch_limit</code><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.infeed_bucket_batch_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the bucket batch limit for one infeed host.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.InfeedBatchSize">
<code class="sig-name descname">InfeedBatchSize</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator.InfeedBatchSize"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.InfeedBatchSize" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the batch size of one infeed pipeline.</p>
<p>Override in subclass to provide dynamically shaped infeed batch size.</p>
<p>If use_per_host_infeed is False then there is only one infeed pipeline and
then the GlobalBatchSize() and the InfeedBatchSize() is the same.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator._InputOpBucketingArgs">
<code class="sig-name descname">_InputOpBucketingArgs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator._InputOpBucketingArgs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator._InputOpBucketingArgs" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.StringsToIds">
<code class="sig-name descname">StringsToIds</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">strs</span></em>, <em class="sig-param"><span class="n">is_source</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">external_max_length</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">external_append_eos</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">key</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">languages</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator.StringsToIds"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.StringsToIds" title="Permalink to this definition">¶</a></dt>
<dd><p>Tokenize strs into vocab ids.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>strs</strong> – A vector of strings.</p></li>
<li><p><strong>is_source</strong> – A bool to indicate whether to use <code class="xref py py-obj docutils literal notranslate"><span class="pre">source_max_length</span></code> to pad
‘strs’.</p></li>
<li><p><strong>external_max_length</strong> – An int providing the max_length for strs.</p></li>
<li><p><strong>external_append_eos</strong> – Bool or None. If None, will be ignored and
<code class="xref py py-obj docutils literal notranslate"><span class="pre">params.append_eos</span></code> will be used. If bool, will determine if an eos
symbol will be added to tokens.</p></li>
<li><p><strong>key</strong> – A string key in case the model has multiple tokenizers.</p></li>
<li><p><strong>languages</strong> – A vector of str with the same length as <code class="xref py py-obj docutils literal notranslate"><span class="pre">strs</span></code>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A tuple (ids, labels, paddings) with the same shape [batch, maxlen].</p>
<ul class="simple">
<li><p>ids[i, j] is the input token id of i-th sample for j-th step.</p></li>
<li><p>labels[i, j] is the target token id of i-th sample for j-th step.</p></li>
<li><p>paddings[i, j] is 1 iff i-th sample’s j-th step is padded.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – If unknown token type.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.IdsToStrings">
<code class="sig-name descname">IdsToStrings</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ids</span></em>, <em class="sig-param"><span class="n">lens</span></em>, <em class="sig-param"><span class="n">key</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator.IdsToStrings"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.IdsToStrings" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts ids back to strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ids</strong> – A matrix of shape [batch, seqlen]. ids[i, :] is the i-th sample’s
ids.</p></li>
<li><p><strong>lens</strong> – A vector of shape [batch]. lens[i] is the sequence length of the
i-th sample. Only the first lens[i] tokens in ids[i, :] are valid tokens
for the i-th sequence.</p></li>
<li><p><strong>key</strong> – A string key in case the model has multiple tokenizers.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sequences - A vector of shape [batch]. The converted string sequence.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3.7/library/exceptions.html#ValueError" title="(in Python v3.7)"><strong>ValueError</strong></a> – If unknown token type.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseSequenceInputGenerator.Cast">
<code class="sig-name descname">Cast</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">v</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseSequenceInputGenerator.Cast"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseSequenceInputGenerator.Cast" title="Permalink to this definition">¶</a></dt>
<dd><p>Cast tensor dtype to fprop_dtype.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_input_generator.BaseTinyDatasetInput">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_input_generator.</code><code class="sig-name descname">BaseTinyDatasetInput</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseTinyDatasetInput"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseTinyDatasetInput" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_input_generator.BaseInputGenerator" title="lingvo.core.base_input_generator.BaseInputGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_input_generator.BaseInputGenerator</span></code></a></p>
<p>Input generator for tiny dataset which are stored in tf checkpoint.</p>
<div class="line-block">
<div class="line">Input batch (b: batch size, h: height, w: width, d: depth):</div>
<div class="line-block">
<div class="line">raw: Samples. [b, h, w, d].</div>
<div class="line">data: Preprocessed samples. [b, h, w, d].</div>
<div class="line">label: Labels. [b].</div>
<div class="line">weight: [b]. weight[i] is 1.0 if i-th sample is considered to</div>
<div class="line-block">
<div class="line">be a real example. Otherwise, weight[i] is 0.0.</div>
</div>
</div>
</div>
<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseTinyDatasetInput.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseTinyDatasetInput.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseTinyDatasetInput.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults params.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseTinyDatasetInput._InputBatch">
<code class="sig-name descname">_InputBatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseTinyDatasetInput._InputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseTinyDatasetInput._InputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>The current input batch, not preprocessed.</p>
<p>This is meant to be overridden by subclasses, but not called directly.
Callers should use <code class="xref py py-obj docutils literal notranslate"><span class="pre">GetPreprocessedInputBatch()</span></code>.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>A <a class="reference internal" href="lingvo.core.py_utils.html#lingvo.core.py_utils.NestedMap" title="lingvo.core.py_utils.NestedMap"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NestedMap</span></code></a> of input tensors. Each tensor’s dim-0 must be the same
and denotes the batch dimension.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseTinyDatasetInput._Preprocess">
<code class="sig-name descname">_Preprocess</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">raw</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseTinyDatasetInput._Preprocess"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseTinyDatasetInput._Preprocess" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="lingvo.core.base_input_generator.BaseDataExampleInputGenerator">
<em class="property">class </em><code class="sig-prename descclassname">lingvo.core.base_input_generator.</code><code class="sig-name descname">BaseDataExampleInputGenerator</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">params</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseDataExampleInputGenerator"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseDataExampleInputGenerator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#lingvo.core.base_input_generator.BaseInputGenerator" title="lingvo.core.base_input_generator.BaseInputGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">lingvo.core.base_input_generator.BaseInputGenerator</span></code></a></p>
<p>Base class for input generators that read Feature protos via tf.data.</p>
<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseDataExampleInputGenerator.Params">
<em class="property">classmethod </em><code class="sig-name descname">Params</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseDataExampleInputGenerator.Params"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseDataExampleInputGenerator.Params" title="Permalink to this definition">¶</a></dt>
<dd><p>Defaults params for input generators.</p>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseDataExampleInputGenerator.GetFeatureSpec">
<code class="sig-name descname">GetFeatureSpec</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseDataExampleInputGenerator.GetFeatureSpec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseDataExampleInputGenerator.GetFeatureSpec" title="Permalink to this definition">¶</a></dt>
<dd><p>Subclasses must implement and return a feature spec.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>NestedMap of features compatible with tf.parse_example. Default
implementation returns an empty dict.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="lingvo.core.base_input_generator.BaseDataExampleInputGenerator.GetPreprocessedInputBatch">
<code class="sig-name descname">GetPreprocessedInputBatch</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lingvo/core/base_input_generator.html#BaseDataExampleInputGenerator.GetPreprocessedInputBatch"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#lingvo.core.base_input_generator.BaseDataExampleInputGenerator.GetPreprocessedInputBatch" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a NestedMap containing a preprocessed batch of inputs.</p>
<p>These are the actual inputs fed to the model.</p>
<p>Subclasses generally should not override this function directly. Instead,
override _InputBatch and maybe _PreprocessInputBatch.</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lingvo.core.base_layer.html" class="btn btn-neutral float-right" title="lingvo.core.base_layer module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="lingvo.core.base_decoder.html" class="btn btn-neutral float-left" title="lingvo.core.base_decoder module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>